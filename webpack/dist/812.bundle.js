"use strict";(self.webpackChunkmonaco_custom_bundle=self.webpackChunkmonaco_custom_bundle||[]).push([[812],{51812:(e,t,s)=>{s.r(t),s.d(t,{default:()=>w}),s(29769);var o=s(88216),r=s(80855),i=s(70666),n=s(72065),c=s(5976),l=s(73733),d=s(8417),a=s(5826),h=s(66663),u=s(75882),v=s(75761),f=s(64862),M=s(95215);let m=class extends c.JT{constructor(e,t,s){super(),this._modelService=e,this._textModelService=t,this._undoRedoService=s,this._register(this._modelService.onModelRemoved((e=>{const t=this._undoRedoService.getElements(e.uri);if(0!==t.past.length||0!==t.future.length){for(const e of t.past)e instanceof M.z5&&e.setDelegate(this);for(const e of t.future)e instanceof M.z5&&e.setDelegate(this)}})))}prepareUndoRedo(e){const t=e.getMissingModels();if(0===t.length)return c.JT.None;const s=t.map((async e=>{try{return await this._textModelService.createModelReference(e)}catch(e){return c.JT.None}}));return Promise.all(s).then((e=>({dispose:()=>(0,c.B9)(e)})))}};m=(0,r.g)([(0,r.f)(0,l.q),(0,r.f)(1,o.S),(0,r.f)(2,f.tJ)],m);var p=s(48205);let S=class extends c.os{constructor(e,t,s,o){super(),this.instantiationService=e,this.textFileService=t,this.fileService=s,this.modelService=o,this.providers=new Map,this.modelsToDispose=new Set}createReferencedObject(e){return this.doCreateReferencedObject(e)}async doCreateReferencedObject(e,t){this.modelsToDispose.delete(e);const s=i.ov.parse(e);if(s.scheme===h.lg.inMemory){if(!this.modelService.getModel(s))throw new Error(`Unable to resolve inMemory resource ${e}`);const t=this.instantiationService.createInstance(d.D,s);if(this.ensureResolvedModel(t,e))return t}if(s.scheme===h.lg.untitled){const t=await this.textFileService.untitled.resolve({untitledResource:s});if(this.ensureResolvedModel(t,e))return t}if(this.fileService.hasProvider(s)){const t=await this.textFileService.files.resolve(s,{reason:2});if(this.ensureResolvedModel(t,e))return t}if(this.providers.has(s.scheme)){await this.resolveTextModelContent(e);const t=this.instantiationService.createInstance(d.D,s);if(this.ensureResolvedModel(t,e))return t}if(!t)return await this.fileService.activateProvider(s.scheme),this.doCreateReferencedObject(e,!0);throw new Error(`Unable to resolve resource ${e}`)}ensureResolvedModel(e,t){if((0,o.B)(e))return!0;throw new Error(`Unable to resolve resource ${t}`)}destroyReferencedObject(e,t){const s=i.ov.parse(e);s.scheme!==h.lg.untitled&&s.scheme!==h.lg.inMemory&&(this.modelsToDispose.add(e),(async()=>{try{const s=await t;if(!this.modelsToDispose.has(e))return;if(s instanceof u.O&&await this.textFileService.files.canDispose(s),!this.modelsToDispose.has(e))return;s.dispose()}catch(e){}finally{this.modelsToDispose.delete(e)}})())}registerTextModelContentProvider(e,t){let s=this.providers.get(e);return s||(s=[],this.providers.set(e,s)),s.unshift(t),(0,c.OF)((()=>{const s=this.providers.get(e);if(!s)return;const o=s.indexOf(t);-1!==o&&(s.splice(o,1),0===s.length&&this.providers.delete(e))}))}hasTextModelContentProvider(e){return void 0!==this.providers.get(e)}async resolveTextModelContent(e){const t=i.ov.parse(e),s=this.providers.get(t.scheme)||[];for(const e of s){const s=await e.provideTextContent(t);if(s)return s}throw new Error(`Unable to resolve text model content for resource ${e}`)}};S=(0,r.g)([(0,r.f)(0,n.TG),(0,r.f)(1,a.MM),(0,r.f)(2,v.sn),(0,r.f)(3,l.q)],S);let g=class extends c.JT{get resourceModelCollection(){return this._resourceModelCollection||(this._resourceModelCollection=this.instantiationService.createInstance(S)),this._resourceModelCollection}get asyncModelCollection(){return this._asyncModelCollection||(this._asyncModelCollection=new c.kR(this.resourceModelCollection)),this._asyncModelCollection}constructor(e,t,s,o,r){super(),this.instantiationService=e,this.fileService=t,this.undoRedoService=s,this.modelService=o,this.uriIdentityService=r,this._resourceModelCollection=void 0,this._asyncModelCollection=void 0,this._register(new m(this.modelService,this,this.undoRedoService))}async createModelReference(e){return e=this.uriIdentityService.asCanonicalUri(e),await this.asyncModelCollection.acquire(e.toString())}registerTextModelContentProvider(e,t){return this.resourceModelCollection.registerTextModelContentProvider(e,t)}canHandleResource(e){return!(!this.fileService.hasProvider(e)&&e.scheme!==h.lg.untitled&&e.scheme!==h.lg.inMemory)||this.resourceModelCollection.hasTextModelContentProvider(e.scheme)}};g=(0,r.g)([(0,r.f)(0,n.TG),(0,r.f)(1,v.sn),(0,r.f)(2,f.tJ),(0,r.f)(3,l.q),(0,r.f)(4,p.v)],g);var C=s(97108);function w(){return{[o.S.toString()]:new C.M(g,void 0,!0)}}}}]);
//# sourceMappingURL=812.bundle.js.map