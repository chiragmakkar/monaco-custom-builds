"use strict";(self.webpackChunkmonaco_custom_bundle=self.webpackChunkmonaco_custom_bundle||[]).push([[700],{26700:(e,t,i)=>{i.r(t),i.d(t,{ConfigurationScope:()=>We,configurationRegistry:()=>Ct,default:()=>mt,getUserConfiguration:()=>ft,onUserConfigurationChange:()=>pt,updateUserConfiguration:()=>dt});var r=i(80855),o=(i(29769),i(77364)),s=i(70666),n=i(4669),a=i(43702),c=i(36248),h=i(5976),u=i(15393),g=i(81294),l=i(40382),d=i(19461),f=i(33108),p=i(23191),C=i(98401),w=i(9488);class v extends d.wU{constructor(e){super(e),this._folders=[],this._transient=!1,this._settingsModelParser=new d.wU(e),this._launchModel=new d.VV,this._tasksModel=new d.VV}get folders(){return this._folders}get transient(){return this._transient}get settingsModel(){return this._settingsModelParser.configurationModel}get launchModel(){return this._launchModel}get tasksModel(){return this._tasksModel}reparseWorkspaceSettings(e){this._settingsModelParser.reparse(e)}getRestrictedWorkspaceSettings(){return this._settingsModelParser.restrictedConfigurations}doParseRaw(e,t){return this._folders=e.folders||[],this._transient=(0,C.jn)(e.transient)&&e.transient,this._settingsModelParser.parseRaw(e.settings,t),this._launchModel=this.createConfigurationModelFrom(e,"launch"),this._tasksModel=this.createConfigurationModelFrom(e,"tasks"),super.doParseRaw(e,t)}createConfigurationModelFrom(e,t){const i=e[t];if(i){const e=(0,f.Od)(i,(e=>console.error(`Conflict in settings file ${this._name}: ${e}`))),r=Object.create(null);r[t]=e;const o=Object.keys(i).map((e=>`${t}.${e}`));return new d.VV(r,o,[])}return new d.VV}}class k extends d.wU{constructor(e,t){super(e),this.scope=t}doParseRaw(e,t){const i=(0,f.Od)(e,(e=>console.error(`Conflict in settings file ${this._name}: ${e}`))),r=Object.create(null);return r[this.scope]=i,{contents:r,keys:Object.keys(e).map((e=>`${this.scope}.${e}`)),overrides:[]}}}class S extends d.VK{constructor(e,t,i,r,o,s,n,a,c,h){super(e,t,i,r,o,s,n,a,c),this._workspace=h}getValue(e,t={}){return super.getValue(e,t,this._workspace)}inspect(e,t={}){return super.inspect(e,t,this._workspace)}keys(){return super.keys(this._workspace)}compareAndDeleteFolderConfiguration(e){return this._workspace&&this._workspace.folders.length>0&&this._workspace.folders[0].uri.toString()===e.toString()?{keys:[],overrides:[]}:super.compareAndDeleteFolderConfiguration(e)}compare(e){const t=(t,i,r)=>{const o=[];return o.push(...i.filter((e=>-1===t.indexOf(e)))),o.push(...t.filter((e=>-1===i.indexOf(e)))),o.push(...t.filter((t=>-1!==i.indexOf(t)&&(!(0,c.fS)(this.getValue(t,{overrideIdentifier:r}),e.getValue(t,{overrideIdentifier:r}))||this._workspace&&this._workspace.folders.some((i=>!(0,c.fS)(this.getValue(t,{resource:i.uri,overrideIdentifier:r}),e.getValue(t,{resource:i.uri,overrideIdentifier:r})))))))),o},i=t(this.allKeys(),e.allKeys()),r=[],o=(0,w.EB)([...this.allOverrideIdentifiers(),...e.allOverrideIdentifiers()]);for(const i of o){const o=t(this.getAllKeysForOverrideIdentifier(i),e.getAllKeysForOverrideIdentifier(i),i);o.length&&r.push([i,o])}return{keys:i,overrides:r}}}var m=i(10469),y=i(89872),_=i(23193),b=i(18076),W=i(63580),D=i(61683),F=i(60449),P=i(5826),R=i(75761),U=i(88216),I=i(24448),E=i(59422),O=i(46973),x=i(48205),N=i(24314),A=i(69386),T=i(3860),M=i(49452),V=i(35838),L=i(17301);class z extends L.QD{constructor(e,t){super(e),this.code=t}}let j=class{constructor(e,t,i,r,o,s,n,a,c,h,g,l){this.remoteSettingsResource=e,this.configurationService=t,this.contextService=i,this.userDataProfileService=r,this.userDataProfilesService=o,this.fileService=s,this.textModelResolverService=n,this.textFileService=a,this.notificationService=c,this.preferencesService=h,this.editorService=g,this.uriIdentityService=l,this.queue=new u.ci}async writeConfiguration(e,t,i={}){const r=this.getConfigurationEditOperation(e,t,i.scopes||{});return this.queue.queue((async()=>{try{await this.doWriteConfiguration(r,i)}catch(e){if(i.donotNotifyError)throw e;await this.onError(e,r,i.scopes)}}))}async doWriteConfiguration(e,t){await this.validate(e.target,e,!t.handleDirtyFile,t.scopes||{});const i=e.resource,r=await this.resolveModelReference(i);try{const i=this.getFormattingOptions(r.object.textEditorModel);await this.updateConfiguration(e,r.object.textEditorModel,i,t)}finally{r.dispose()}}async updateConfiguration(e,t,i,r){if(this.hasParseErrors(t.getValue(),e))throw this.toConfigurationEditingError(11,e.target,e);if(this.textFileService.isDirty(t.uri)&&r.handleDirtyFile)switch(r.handleDirtyFile){case"save":await this.save(t,e);break;case"revert":await this.textFileService.revert(t.uri)}const o=this.getEdits(e,t.getValue(),i)[0];o&&this.applyEditsToBuffer(o,t)&&await this.save(t,e)}async save(e,t){try{await this.textFileService.save(e.uri,{ignoreErrorHandler:!0})}catch(e){if(3===e.fileOperationResult)throw this.toConfigurationEditingError(10,t.target,t);throw new z(W.NC("fsError","Error while writing to {0}. {1}",this.stringifyTarget(t.target),e.message),13)}}applyEditsToBuffer(e,t){const i=t.getPositionAt(e.offset),r=t.getPositionAt(e.offset+e.length),o=new N.e(i.lineNumber,i.column,r.lineNumber,r.column),s=t.getValueInRange(o);if(e.content!==s){const r=s?A.h.replace(o,e.content):A.h.insert(i,e.content);return t.pushEditOperations([new T.Y(i.lineNumber,i.column,i.lineNumber,i.column)],[r],(()=>[])),!0}return!1}getEdits({value:e,jsonPath:t},i,r){return t.length?(0,F.Hn)(i,t,e,r):[{content:JSON.stringify(e,null,r.insertSpaces&&r.tabSize?" ".repeat(r.tabSize):"\t"),length:i.length,offset:0}]}getFormattingOptions(e){const{insertSpaces:t,tabSize:i}=e.getOptions();return{insertSpaces:t,tabSize:i,eol:e.getEOL()}}async onError(e,t,i){switch(e.code){case 11:this.onInvalidConfigurationError(e,t);break;case 9:this.onConfigurationFileDirtyError(e,t,i);break;case 10:return this.doWriteConfiguration(t,{scopes:i,handleDirtyFile:"revert"});default:this.notificationService.error(e.message)}}onInvalidConfigurationError(e,t){const i=t.workspaceStandAloneConfigurationKey===m.QN?W.NC("openTasksConfiguration","Open Tasks Configuration"):t.workspaceStandAloneConfigurationKey===m.Bf?W.NC("openLaunchConfiguration","Open Launch Configuration"):null;i?this.notificationService.prompt(E.zb.Error,e.message,[{label:i,run:()=>this.openFile(t.resource)}]):this.notificationService.prompt(E.zb.Error,e.message,[{label:W.NC("open","Open Settings"),run:()=>this.openSettings(t)}])}onConfigurationFileDirtyError(e,t,i){const r=t.workspaceStandAloneConfigurationKey===m.QN?W.NC("openTasksConfiguration","Open Tasks Configuration"):t.workspaceStandAloneConfigurationKey===m.Bf?W.NC("openLaunchConfiguration","Open Launch Configuration"):null;r?this.notificationService.prompt(E.zb.Error,e.message,[{label:W.NC("saveAndRetry","Save and Retry"),run:()=>{const e=t.key?`${t.workspaceStandAloneConfigurationKey}.${t.key}`:t.workspaceStandAloneConfigurationKey;this.writeConfiguration(t.target,{key:e,value:t.value},{handleDirtyFile:"save",scopes:i})}},{label:r,run:()=>this.openFile(t.resource)}]):this.notificationService.prompt(E.zb.Error,e.message,[{label:W.NC("saveAndRetry","Save and Retry"),run:()=>this.writeConfiguration(t.target,{key:t.key,value:t.value},{handleDirtyFile:"save",scopes:i})},{label:W.NC("open","Open Settings"),run:()=>this.openSettings(t)}])}openSettings(e){const t={jsonEditor:!0};switch(e.target){case 1:this.preferencesService.openUserSettings(t);break;case 2:this.preferencesService.openRemoteSettings(t);break;case 3:this.preferencesService.openWorkspaceSettings(t);break;case 4:if(e.resource){const t=this.contextService.getWorkspaceFolder(e.resource);t&&this.preferencesService.openFolderSettings({folderUri:t.uri,jsonEditor:!0})}}}openFile(e){this.editorService.openEditor({resource:e,options:{pinned:!0}})}toConfigurationEditingError(e,t,i){const r=this.toErrorMessage(e,t,i);return new z(r,e)}toErrorMessage(e,t,i){switch(e){case 12:return W.NC("errorPolicyConfiguration","Unable to write {0} because it is configured in system policy.",i.key);case 0:return W.NC("errorUnknownKey","Unable to write to {0} because {1} is not a registered configuration.",this.stringifyTarget(t),i.key);case 1:return W.NC("errorInvalidWorkspaceConfigurationApplication","Unable to write {0} to Workspace Settings. This setting can be written only into User settings.",i.key);case 2:return W.NC("errorInvalidWorkspaceConfigurationMachine","Unable to write {0} to Workspace Settings. This setting can be written only into User settings.",i.key);case 3:return W.NC("errorInvalidFolderConfiguration","Unable to write to Folder Settings because {0} does not support the folder resource scope.",i.key);case 4:return W.NC("errorInvalidUserTarget","Unable to write to User Settings because {0} does not support for global scope.",i.key);case 5:return W.NC("errorInvalidWorkspaceTarget","Unable to write to Workspace Settings because {0} does not support for workspace scope in a multi folder workspace.",i.key);case 6:return W.NC("errorInvalidFolderTarget","Unable to write to Folder Settings because no resource is provided.");case 7:return W.NC("errorInvalidResourceLanguageConfiguration","Unable to write to Language Settings because {0} is not a resource language setting.",i.key);case 8:return W.NC("errorNoWorkspaceOpened","Unable to write to {0} because no workspace is opened. Please open a workspace first and try again.",this.stringifyTarget(t));case 11:if(i.workspaceStandAloneConfigurationKey===m.QN)return W.NC("errorInvalidTaskConfiguration","Unable to write into the tasks configuration file. Please open it to correct errors/warnings in it and try again.");if(i.workspaceStandAloneConfigurationKey===m.Bf)return W.NC("errorInvalidLaunchConfiguration","Unable to write into the launch configuration file. Please open it to correct errors/warnings in it and try again.");switch(t){case 1:return W.NC("errorInvalidConfiguration","Unable to write into user settings. Please open the user settings to correct errors/warnings in it and try again.");case 2:return W.NC("errorInvalidRemoteConfiguration","Unable to write into remote user settings. Please open the remote user settings to correct errors/warnings in it and try again.");case 3:return W.NC("errorInvalidConfigurationWorkspace","Unable to write into workspace settings. Please open the workspace settings to correct errors/warnings in the file and try again.");case 4:{let e="<<unknown>>";if(i.resource){const t=this.contextService.getWorkspaceFolder(i.resource);t&&(e=t.name)}return W.NC("errorInvalidConfigurationFolder","Unable to write into folder settings. Please open the '{0}' folder settings to correct errors/warnings in it and try again.",e)}default:return""}case 9:if(i.workspaceStandAloneConfigurationKey===m.QN)return W.NC("errorTasksConfigurationFileDirty","Unable to write into tasks configuration file because the file has unsaved changes. Please save it first and then try again.");if(i.workspaceStandAloneConfigurationKey===m.Bf)return W.NC("errorLaunchConfigurationFileDirty","Unable to write into launch configuration file because the file has unsaved changes. Please save it first and then try again.");switch(t){case 1:return W.NC("errorConfigurationFileDirty","Unable to write into user settings because the file has unsaved changes. Please save the user settings file first and then try again.");case 2:return W.NC("errorRemoteConfigurationFileDirty","Unable to write into remote user settings because the file has unsaved changes. Please save the remote user settings file first and then try again.");case 3:return W.NC("errorConfigurationFileDirtyWorkspace","Unable to write into workspace settings because the file has unsaved changes. Please save the workspace settings file first and then try again.");case 4:{let e="<<unknown>>";if(i.resource){const t=this.contextService.getWorkspaceFolder(i.resource);t&&(e=t.name)}return W.NC("errorConfigurationFileDirtyFolder","Unable to write into folder settings because the file has unsaved changes. Please save the '{0}' folder settings file first and then try again.",e)}default:return""}case 10:if(i.workspaceStandAloneConfigurationKey===m.QN)return W.NC("errorTasksConfigurationFileModifiedSince","Unable to write into tasks configuration file because the content of the file is newer.");if(i.workspaceStandAloneConfigurationKey===m.Bf)return W.NC("errorLaunchConfigurationFileModifiedSince","Unable to write into launch configuration file because the content of the file is newer.");switch(t){case 1:return W.NC("errorConfigurationFileModifiedSince","Unable to write into user settings because the content of the file is newer.");case 2:return W.NC("errorRemoteConfigurationFileModifiedSince","Unable to write into remote user settings because the content of the file is newer.");case 3:return W.NC("errorConfigurationFileModifiedSinceWorkspace","Unable to write into workspace settings because the content of the file is newer.");case 4:return W.NC("errorConfigurationFileModifiedSinceFolder","Unable to write into folder settings because the content of the file is newer.")}case 13:return W.NC("errorUnknown","Unable to write to {0} because of an internal error.",this.stringifyTarget(t))}}stringifyTarget(e){switch(e){case 1:return W.NC("userTarget","User Settings");case 2:return W.NC("remoteUserTarget","Remote User Settings");case 3:return W.NC("workspaceTarget","Workspace Settings");case 4:return W.NC("folderTarget","Folder Settings");default:return""}}defaultResourceValue(e){const t=this.uriIdentityService.extUri.basename(e);return t.substr(0,t.length-this.uriIdentityService.extUri.extname(e).length)===m.QN?m.iF:"{}"}async resolveModelReference(e){return await this.fileService.exists(e)||await this.textFileService.write(e,this.defaultResourceValue(e),{encoding:"utf8"}),this.textModelResolverService.createModelReference(e)}hasParseErrors(e,t){if(t.workspaceStandAloneConfigurationKey&&!t.key)return!1;const i=[];return D.Qc(e,i,{allowTrailingComma:!0,allowEmptyContent:!0}),i.length>0}async validate(e,t,i,r){if(void 0!==this.configurationService.inspect(t.key).policyValue)throw this.toConfigurationEditingError(12,e,t);const o=y.B.as(_.IP.Configuration).getConfigurationProperties(),s=o[t.key]?.scope;if(!t.workspaceStandAloneConfigurationKey&&this.configurationService.keys().default.indexOf(t.key)<0&&!_.eU.test(t.key)&&void 0!==t.value)throw this.toConfigurationEditingError(0,e,t);if(t.workspaceStandAloneConfigurationKey&&t.workspaceStandAloneConfigurationKey!==m.QN&&(1===e||2===e))throw this.toConfigurationEditingError(4,e,t);if((3===e||4===e)&&1===this.contextService.getWorkbenchState())throw this.toConfigurationEditingError(8,e,t);if(3===e&&!t.workspaceStandAloneConfigurationKey&&!_.eU.test(t.key)){if(1===s)throw this.toConfigurationEditingError(1,e,t);if(2===s)throw this.toConfigurationEditingError(2,e,t)}if(4===e){if(!t.resource)throw this.toConfigurationEditingError(6,e,t);if(!t.workspaceStandAloneConfigurationKey&&!_.eU.test(t.key)&&void 0!==s&&!m.ao.includes(s))throw this.toConfigurationEditingError(3,e,t)}if(r.overrideIdentifiers?.length&&5!==s)throw this.toConfigurationEditingError(7,e,t);if(!t.resource)throw this.toConfigurationEditingError(6,e,t);if(i&&this.textFileService.isDirty(t.resource))throw this.toConfigurationEditingError(9,e,t)}getConfigurationEditOperation(e,t,i){if(t.key){const r=1===e?m.el:m.A6,o=Object.keys(r);for(const s of o){const o=this.getConfigurationFileResource(e,s,r[s],i.resource,void 0);if(t.key===s){const i=this.isWorkspaceConfigurationResource(o)?[s]:[];return{key:i[i.length-1],jsonPath:i,value:t.value,resource:(0,C.f6)(o),workspaceStandAloneConfigurationKey:s,target:e}}const n=`${s}.`;if(0===t.key.indexOf(n)){const i=this.isWorkspaceConfigurationResource(o)?[s,t.key.substr(n.length)]:[t.key.substr(n.length)];return{key:i[i.length-1],jsonPath:i,value:t.value,resource:(0,C.f6)(o),workspaceStandAloneConfigurationKey:s,target:e}}}}const r=t.key,o=y.B.as(_.IP.Configuration).getConfigurationProperties(),s=o[r]?.scope;let n=i.overrideIdentifiers?.length?[(0,_.np)(i.overrideIdentifiers),r]:[r];if(1===e||2===e)return{key:r,jsonPath:n,value:t.value,resource:(0,C.f6)(this.getConfigurationFileResource(e,r,"",null,s)),target:e};const a=this.getConfigurationFileResource(e,r,m.kd,i.resource,s);return this.isWorkspaceConfigurationResource(a)&&(n=["settings",...n]),{key:r,jsonPath:n,value:t.value,resource:(0,C.f6)(a),target:e}}isWorkspaceConfigurationResource(e){const t=this.contextService.getWorkspace();return!(!t.configuration||!e||t.configuration.fsPath!==e.fsPath)}getConfigurationFileResource(e,t,i,r,o){if(1===e)return t===m.QN?this.userDataProfileService.currentProfile.tasksResource:!this.userDataProfileService.currentProfile.isDefault&&this.configurationService.isSettingAppliedForAllProfiles(t)?this.userDataProfilesService.defaultProfile.settingsResource:this.userDataProfileService.currentProfile.settingsResource;if(2===e)return this.remoteSettingsResource;const s=this.contextService.getWorkbenchState();if(1!==s){const t=this.contextService.getWorkspace();if(3===e){if(3===s)return(0,C.M2)(t.configuration);if(2===s)return t.folders[0].toResource(i)}if(4===e&&r){const e=this.contextService.getWorkspaceFolder(r);if(e)return e.toResource(i)}}return null}};j=(0,r.g)([(0,r.f)(1,m.FG),(0,r.f)(2,l.ec),(0,r.f)(3,M.AP),(0,r.f)(4,V.lv),(0,r.f)(5,R.sn),(0,r.f)(6,U.S),(0,r.f)(7,P.MM),(0,r.f)(8,E.lT),(0,r.f)(9,O.UP),(0,r.f)(10,I.AR),(0,r.f)(11,x.v)],j);var K=i(89954),$=i(95935);class B extends p.l0{static{this.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY="DefaultOverridesCacheExists"}constructor(e,t){super(),this.configurationCache=e,this.configurationRegistry=y.B.as(_.IP.Configuration),this.cachedConfigurationDefaultsOverrides={},this.cacheKey={type:"defaults",key:"configurationDefaultsOverrides"},this.updateCache=!1,t.options?.configurationDefaults&&this.configurationRegistry.registerDefaultConfigurations([{overrides:t.options.configurationDefaults}])}getConfigurationDefaultOverrides(){return this.cachedConfigurationDefaultsOverrides}async initialize(){return await this.initializeCachedConfigurationDefaultsOverrides(),super.initialize()}reload(){return this.updateCache=!0,this.cachedConfigurationDefaultsOverrides={},this.updateCachedConfigurationDefaultsOverrides(),super.reload()}hasCachedConfigurationDefaultsOverrides(){return!(0,C.Qr)(this.cachedConfigurationDefaultsOverrides)}initializeCachedConfigurationDefaultsOverrides(){return this.initiaizeCachedConfigurationDefaultsOverridesPromise||(this.initiaizeCachedConfigurationDefaultsOverridesPromise=(async()=>{try{if(window.localStorage.getItem(B.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY)){const e=await this.configurationCache.read(this.cacheKey);e&&(this.cachedConfigurationDefaultsOverrides=JSON.parse(e))}}catch(e){}this.cachedConfigurationDefaultsOverrides=(0,C.Kn)(this.cachedConfigurationDefaultsOverrides)?this.cachedConfigurationDefaultsOverrides:{}})()),this.initiaizeCachedConfigurationDefaultsOverridesPromise}onDidUpdateConfiguration(e,t){super.onDidUpdateConfiguration(e,t),t&&this.updateCachedConfigurationDefaultsOverrides()}async updateCachedConfigurationDefaultsOverrides(){if(!this.updateCache)return;const e={},t=this.configurationRegistry.getConfigurationDefaultsOverrides();for(const[i,r]of t)_.eU.test(i)||void 0===r.value||(e[i]=r.value);try{Object.keys(e).length?(window.localStorage.setItem(B.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY,"yes"),await this.configurationCache.write(this.cacheKey,JSON.stringify(e))):(window.localStorage.removeItem(B.DEFAULT_OVERRIDES_CACHE_EXISTS_KEY),await this.configurationCache.remove(this.cacheKey))}catch(e){}}}class q extends d.PG{constructor(e,t,i){super(e.defaultProfile.settingsResource,{scopes:[1]},i.extUri,t),this._onDidChangeConfiguration=this._register(new n.Q5),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._register(this.onDidChange((()=>this.reloadConfigurationScheduler.schedule()))),this.reloadConfigurationScheduler=this._register(new u.pY((()=>this.loadConfiguration().then((e=>this._onDidChangeConfiguration.fire(e)))),50))}async initialize(){return this.loadConfiguration()}async loadConfiguration(){const e=await super.loadConfiguration(),t=e.getValue(m.ek),i=Array.isArray(t)?t:[];return this.parseOptions.include||i.length?this.reparse({...this.parseOptions,include:i}):e}}class J extends h.JT{get hasTasksLoaded(){return this.userConfiguration.value instanceof Y}constructor(e,t,i,r,o,s){super(),this.settingsResource=e,this.tasksResource=t,this.configurationParseOptions=i,this.fileService=r,this.uriIdentityService=o,this.logService=s,this._onDidChangeConfiguration=this._register(new n.Q5),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this.userConfiguration=this._register(new h.XK),this.userConfigurationChangeDisposable=this._register(new h.XK),this.userConfiguration.value=new d.PG(e,this.configurationParseOptions,o.extUri,this.fileService),this.userConfigurationChangeDisposable.value=this.userConfiguration.value.onDidChange((()=>this.reloadConfigurationScheduler.schedule())),this.reloadConfigurationScheduler=this._register(new u.pY((()=>this.userConfiguration.value.loadConfiguration().then((e=>this._onDidChangeConfiguration.fire(e)))),50))}async reset(e,t,i){this.settingsResource=e,this.tasksResource=t,this.configurationParseOptions=i;const r=this.uriIdentityService.extUri.dirname(this.settingsResource),o=this.tasksResource?[[m.QN,this.tasksResource]]:[],s=new Y(r.toString(),this.settingsResource,o,this.configurationParseOptions,this.fileService,this.uriIdentityService,this.logService),n=await s.loadConfiguration();return this.userConfiguration.value=s,this.userConfigurationChangeDisposable.value&&(this.userConfigurationChangeDisposable.value=this.userConfiguration.value.onDidChange((()=>this.reloadConfigurationScheduler.schedule()))),n}async initialize(){return this.userConfiguration.value.loadConfiguration()}async reload(){return this.hasTasksLoaded?this.userConfiguration.value.loadConfiguration():this.reset(this.settingsResource,this.tasksResource,this.configurationParseOptions)}reparse(e){return this.configurationParseOptions={...this.configurationParseOptions,...e},this.userConfiguration.value.reparse(this.configurationParseOptions)}getRestrictedSettings(){return this.userConfiguration.value.getRestrictedSettings()}}class Y extends h.JT{constructor(e,t,i,r,o,s,a){super(),this.settingsResource=t,this.standAloneConfigurationResources=i,this.fileService=o,this.uriIdentityService=s,this.logService=a,this._onDidChange=this._register(new n.Q5),this.onDidChange=this._onDidChange.event,this.allResources=[this.settingsResource,...this.standAloneConfigurationResources.map((([,e])=>e))],this._register((0,h.F8)(...this.allResources.map((e=>(0,h.F8)(this.fileService.watch(s.extUri.dirname(e)),this.fileService.watch(e)))))),this._folderSettingsModelParser=new d.wU(e),this._folderSettingsParseOptions=r,this._standAloneConfigurations=[],this._cache=new d.VV,this._register(n.ju.debounce(n.ju.any(n.ju.filter(this.fileService.onDidFilesChange,(e=>this.handleFileChangesEvent(e))),n.ju.filter(this.fileService.onDidRunOperation,(e=>this.handleFileOperationEvent(e)))),(()=>{}),100)((()=>this._onDidChange.fire())))}async resolveContents(){const e=async e=>Promise.all(e.map((async e=>{try{return(await this.fileService.readFile(e)).value.toString()}catch(t){this.logService.trace(`Error while resolving configuration file '${e.toString()}': ${L.e$(t)}`),1!==t.fileOperationResult&&9!==t.fileOperationResult&&this.logService.error(t)}return"{}"}))),[[t],i]=await Promise.all([e([this.settingsResource]),e(this.standAloneConfigurationResources.map((([,e])=>e)))]);return[t,i.map(((e,t)=>[this.standAloneConfigurationResources[t][0],e]))]}async loadConfiguration(){const[e,t]=await this.resolveContents();this._standAloneConfigurations=[],this._folderSettingsModelParser.parse("",this._folderSettingsParseOptions),void 0!==e&&this._folderSettingsModelParser.parse(e,this._folderSettingsParseOptions);for(let e=0;e<t.length;e++){const i=t[e][1];if(void 0!==i){const t=new k(this.standAloneConfigurationResources[e][1].toString(),this.standAloneConfigurationResources[e][0]);t.parse(i),this._standAloneConfigurations.push(t.configurationModel)}}return this.consolidate(),this._cache}getRestrictedSettings(){return this._folderSettingsModelParser.restrictedConfigurations}reparse(e){const t=this._folderSettingsModelParser.configurationModel.contents;return this._folderSettingsParseOptions=e,this._folderSettingsModelParser.reparse(this._folderSettingsParseOptions),(0,c.fS)(t,this._folderSettingsModelParser.configurationModel.contents)||this.consolidate(),this._cache}consolidate(){this._cache=this._folderSettingsModelParser.configurationModel.merge(...this._standAloneConfigurations)}handleFileChangesEvent(e){return!!this.allResources.some((t=>e.contains(t)))||!!this.allResources.some((t=>e.contains(this.uriIdentityService.extUri.dirname(t),2)))}handleFileOperationEvent(e){return!(!(e.isOperation(0)||e.isOperation(3)||e.isOperation(1)||e.isOperation(4))||!this.allResources.some((t=>this.uriIdentityService.extUri.isEqual(e.resource,t))))||!(!e.isOperation(1)||!this.allResources.some((t=>this.uriIdentityService.extUri.isEqual(e.resource,this.uriIdentityService.extUri.dirname(t)))))}}class Q extends h.JT{constructor(e,t,i,r,o){super(),this._userConfigurationInitializationPromise=null,this._onDidChangeConfiguration=this._register(new n.Q5),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onDidInitialize=this._register(new n.Q5),this.onDidInitialize=this._onDidInitialize.event,this._fileService=i,this._userConfiguration=this._cachedConfiguration=new G(e,t,{scopes:m.ec}),o.getEnvironment().then((async e=>{if(e){const t=this._register(new H(e.settingsPath,{scopes:m.ec},this._fileService,r));this._register(t.onDidChangeConfiguration((e=>this.onDidUserConfigurationChange(e)))),this._userConfigurationInitializationPromise=t.initialize();const i=await this._userConfigurationInitializationPromise;this._userConfiguration.dispose(),this._userConfiguration=t,this.onDidUserConfigurationChange(i),this._onDidInitialize.fire(i)}}))}async initialize(){if(this._userConfiguration instanceof H)return this._userConfiguration.initialize();let e=await this._userConfiguration.initialize();return this._userConfigurationInitializationPromise&&(e=await this._userConfigurationInitializationPromise,this._userConfigurationInitializationPromise=null),e}reload(){return this._userConfiguration.reload()}reparse(){return this._userConfiguration.reparse({scopes:m.ec})}getRestrictedSettings(){return this._userConfiguration.getRestrictedSettings()}onDidUserConfigurationChange(e){this.updateCache(),this._onDidChangeConfiguration.fire(e)}async updateCache(){if(this._userConfiguration instanceof H){let e;try{e=await this._userConfiguration.resolveContent()}catch(e){if(1!==e.fileOperationResult)return}await this._cachedConfiguration.updateConfiguration(e)}}}class H extends h.JT{constructor(e,t,i,r){super(),this.configurationResource=e,this.fileService=i,this.uriIdentityService=r,this._onDidChangeConfiguration=this._register(new n.Q5),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this.fileWatcherDisposable=h.JT.None,this.directoryWatcherDisposable=h.JT.None,this.parser=new d.wU(this.configurationResource.toString()),this.parseOptions=t,this._register(i.onDidFilesChange((e=>this.handleFileChangesEvent(e)))),this._register(i.onDidRunOperation((e=>this.handleFileOperationEvent(e)))),this.reloadConfigurationScheduler=this._register(new u.pY((()=>this.reload().then((e=>this._onDidChangeConfiguration.fire(e)))),50)),this._register((0,h.OF)((()=>{this.stopWatchingResource(),this.stopWatchingDirectory()})))}watchResource(){this.fileWatcherDisposable=this.fileService.watch(this.configurationResource)}stopWatchingResource(){this.fileWatcherDisposable.dispose(),this.fileWatcherDisposable=h.JT.None}watchDirectory(){const e=this.uriIdentityService.extUri.dirname(this.configurationResource);this.directoryWatcherDisposable=this.fileService.watch(e)}stopWatchingDirectory(){this.directoryWatcherDisposable.dispose(),this.directoryWatcherDisposable=h.JT.None}async initialize(){const e=await this.fileService.exists(this.configurationResource);return this.onResourceExists(e),this.reload()}async resolveContent(){return(await this.fileService.readFile(this.configurationResource)).value.toString()}async reload(){try{const e=await this.resolveContent();return this.parser.parse(e,this.parseOptions),this.parser.configurationModel}catch(e){return new d.VV}}reparse(e){return this.parseOptions=e,this.parser.reparse(this.parseOptions),this.parser.configurationModel}getRestrictedSettings(){return this.parser.restrictedConfigurations}handleFileChangesEvent(e){let t=e.contains(this.configurationResource,0);e.contains(this.configurationResource,1)?(t=!0,this.onResourceExists(!0)):e.contains(this.configurationResource,2)&&(t=!0,this.onResourceExists(!1)),t&&this.reloadConfigurationScheduler.schedule()}handleFileOperationEvent(e){(e.isOperation(0)||e.isOperation(3)||e.isOperation(1)||e.isOperation(4))&&this.uriIdentityService.extUri.isEqual(e.resource,this.configurationResource)&&this.reloadConfigurationScheduler.schedule()}onResourceExists(e){e?(this.stopWatchingDirectory(),this.watchResource()):(this.stopWatchingResource(),this.watchDirectory())}}class G extends h.JT{constructor(e,t,i){super(),this.configurationCache=t,this._onDidChange=this._register(new n.Q5),this.onDidChange=this._onDidChange.event,this.key={type:"user",key:e},this.parser=new d.wU("CachedRemoteUserConfiguration"),this.parseOptions=i,this.configurationModel=new d.VV}getConfigurationModel(){return this.configurationModel}initialize(){return this.reload()}reparse(e){return this.parseOptions=e,this.parser.reparse(this.parseOptions),this.configurationModel=this.parser.configurationModel,this.configurationModel}getRestrictedSettings(){return this.parser.restrictedConfigurations}async reload(){try{const e=await this.configurationCache.read(this.key),t=JSON.parse(e);t.content&&(this.parser.parse(t.content,this.parseOptions),this.configurationModel=this.parser.configurationModel)}catch(e){}return this.configurationModel}async updateConfiguration(e){return e?this.configurationCache.write(this.key,JSON.stringify({content:e})):this.configurationCache.remove(this.key)}}class X extends h.JT{get initialized(){return this._initialized}constructor(e,t,i,r){super(),this.configurationCache=e,this.fileService=t,this.uriIdentityService=i,this.logService=r,this._workspaceConfigurationDisposables=this._register(new h.SL),this._workspaceIdentifier=null,this._isWorkspaceTrusted=!1,this._onDidUpdateConfiguration=this._register(new n.Q5),this.onDidUpdateConfiguration=this._onDidUpdateConfiguration.event,this._initialized=!1,this.fileService=t,this._workspaceConfiguration=this._cachedConfiguration=new ee(e)}async initialize(e,t){this._workspaceIdentifier=e,this._isWorkspaceTrusted=t,this._initialized||(this.configurationCache.needsCaching(this._workspaceIdentifier.configPath)?(this._workspaceConfiguration=this._cachedConfiguration,this.waitAndInitialize(this._workspaceIdentifier)):this.doInitialize(new Z(this.fileService,this.uriIdentityService,this.logService))),await this.reload()}async reload(){this._workspaceIdentifier&&await this._workspaceConfiguration.load(this._workspaceIdentifier,{scopes:m.G,skipRestricted:this.isUntrusted()})}getFolders(){return this._workspaceConfiguration.getFolders()}setFolders(e,t){return this._workspaceIdentifier?t.write(this._workspaceIdentifier.configPath,[{path:["folders"],value:e}],!0).then((()=>this.reload())):Promise.resolve()}isTransient(){return this._workspaceConfiguration.isTransient()}getConfiguration(){return this._workspaceConfiguration.getWorkspaceSettings()}updateWorkspaceTrust(e){return this._isWorkspaceTrusted=e,this.reparseWorkspaceSettings()}reparseWorkspaceSettings(){return this._workspaceConfiguration.reparseWorkspaceSettings({scopes:m.G,skipRestricted:this.isUntrusted()}),this.getConfiguration()}getRestrictedSettings(){return this._workspaceConfiguration.getRestrictedSettings()}async waitAndInitialize(e){if(await(0,R.vP)(e.configPath,this.fileService),!(this._workspaceConfiguration instanceof Z)){const t=this._register(new Z(this.fileService,this.uriIdentityService,this.logService));await t.load(e,{scopes:m.G,skipRestricted:this.isUntrusted()}),this.doInitialize(t),this.onDidWorkspaceConfigurationChange(!1,!0)}}doInitialize(e){this._workspaceConfigurationDisposables.clear(),this._workspaceConfiguration=this._workspaceConfigurationDisposables.add(e),this._workspaceConfigurationDisposables.add(this._workspaceConfiguration.onDidChange((e=>this.onDidWorkspaceConfigurationChange(!0,!1)))),this._initialized=!0}isUntrusted(){return!this._isWorkspaceTrusted}async onDidWorkspaceConfigurationChange(e,t){e&&await this.reload(),this.updateCache(),this._onDidUpdateConfiguration.fire(t)}async updateCache(){if(this._workspaceIdentifier&&this.configurationCache.needsCaching(this._workspaceIdentifier.configPath)&&this._workspaceConfiguration instanceof Z){const e=await this._workspaceConfiguration.resolveContent(this._workspaceIdentifier);await this._cachedConfiguration.updateWorkspace(this._workspaceIdentifier,e)}}}class Z extends h.JT{constructor(e,t,i){super(),this.fileService=e,this.logService=i,this._workspaceIdentifier=null,this._onDidChange=this._register(new n.Q5),this.onDidChange=this._onDidChange.event,this.workspaceConfigurationModelParser=new v(""),this.workspaceSettings=new d.VV,this._register(n.ju.any(n.ju.filter(this.fileService.onDidFilesChange,(e=>!!this._workspaceIdentifier&&e.contains(this._workspaceIdentifier.configPath))),n.ju.filter(this.fileService.onDidRunOperation,(e=>!!this._workspaceIdentifier&&(e.isOperation(0)||e.isOperation(3)||e.isOperation(1)||e.isOperation(4))&&t.extUri.isEqual(e.resource,this._workspaceIdentifier.configPath))))((()=>this.reloadConfigurationScheduler.schedule()))),this.reloadConfigurationScheduler=this._register(new u.pY((()=>this._onDidChange.fire()),50)),this.workspaceConfigWatcher=this._register(this.watchWorkspaceConfigurationFile())}get workspaceIdentifier(){return this._workspaceIdentifier}async resolveContent(e){return(await this.fileService.readFile(e.configPath)).value.toString()}async load(e,t){this._workspaceIdentifier&&this._workspaceIdentifier.id===e.id||(this._workspaceIdentifier=e,this.workspaceConfigurationModelParser=new v(this._workspaceIdentifier.id),(0,h.B9)(this.workspaceConfigWatcher),this.workspaceConfigWatcher=this._register(this.watchWorkspaceConfigurationFile()));let i="";try{i=await this.resolveContent(this._workspaceIdentifier)}catch(e){await this.fileService.exists(this._workspaceIdentifier.configPath)&&this.logService.error(e)}this.workspaceConfigurationModelParser.parse(i,t),this.consolidate()}getConfigurationModel(){return this.workspaceConfigurationModelParser.configurationModel}getFolders(){return this.workspaceConfigurationModelParser.folders}isTransient(){return this.workspaceConfigurationModelParser.transient}getWorkspaceSettings(){return this.workspaceSettings}reparseWorkspaceSettings(e){return this.workspaceConfigurationModelParser.reparseWorkspaceSettings(e),this.consolidate(),this.getWorkspaceSettings()}getRestrictedSettings(){return this.workspaceConfigurationModelParser.getRestrictedWorkspaceSettings()}consolidate(){this.workspaceSettings=this.workspaceConfigurationModelParser.settingsModel.merge(this.workspaceConfigurationModelParser.launchModel,this.workspaceConfigurationModelParser.tasksModel)}watchWorkspaceConfigurationFile(){return this._workspaceIdentifier?this.fileService.watch(this._workspaceIdentifier.configPath):h.JT.None}}class ee{constructor(e){this.configurationCache=e,this.onDidChange=n.ju.None,this.workspaceConfigurationModelParser=new v(""),this.workspaceSettings=new d.VV}async load(e,t){try{const i=this.getKey(e),r=await this.configurationCache.read(i),o=JSON.parse(r);o.content&&(this.workspaceConfigurationModelParser=new v(i.key),this.workspaceConfigurationModelParser.parse(o.content,t),this.consolidate())}catch(e){}}get workspaceIdentifier(){return null}getConfigurationModel(){return this.workspaceConfigurationModelParser.configurationModel}getFolders(){return this.workspaceConfigurationModelParser.folders}isTransient(){return this.workspaceConfigurationModelParser.transient}getWorkspaceSettings(){return this.workspaceSettings}reparseWorkspaceSettings(e){return this.workspaceConfigurationModelParser.reparseWorkspaceSettings(e),this.consolidate(),this.getWorkspaceSettings()}getRestrictedSettings(){return this.workspaceConfigurationModelParser.getRestrictedWorkspaceSettings()}consolidate(){this.workspaceSettings=this.workspaceConfigurationModelParser.settingsModel.merge(this.workspaceConfigurationModelParser.launchModel,this.workspaceConfigurationModelParser.tasksModel)}async updateWorkspace(e,t){try{const i=this.getKey(e);t?await this.configurationCache.write(i,JSON.stringify({content:t})):await this.configurationCache.remove(i)}catch(e){}}getKey(e){return{type:"workspaces",key:e.id}}}class te{constructor(e,t,i,r){this.configurationCache=r,this.onDidChange=n.ju.None,this.key={type:"folder",key:(0,K.vp)((0,$.Vo)(e,t).toString()).toString(16)},this._folderSettingsModelParser=new d.wU("CachedFolderConfiguration"),this._folderSettingsParseOptions=i,this._standAloneConfigurations=[],this.configurationModel=new d.VV}async loadConfiguration(){try{const e=await this.configurationCache.read(this.key),{content:t}=JSON.parse(e.toString());if(t)for(const e of Object.keys(t))if(e===m.l3)this._folderSettingsModelParser.parse(t[e],this._folderSettingsParseOptions);else{const i=new k(e,e);i.parse(t[e]),this._standAloneConfigurations.push(i.configurationModel)}this.consolidate()}catch(e){}return this.configurationModel}async updateConfiguration(e,t){const i={};e&&(i[m.l3]=e),t.forEach((([e,t])=>{t&&(i[e]=t)})),Object.keys(i).length?await this.configurationCache.write(this.key,JSON.stringify({content:i})):await this.configurationCache.remove(this.key)}getRestrictedSettings(){return this._folderSettingsModelParser.restrictedConfigurations}reparse(e){return this._folderSettingsParseOptions=e,this._folderSettingsModelParser.reparse(this._folderSettingsParseOptions),this.consolidate(),this.configurationModel}consolidate(){this.configurationModel=this._folderSettingsModelParser.configurationModel.merge(...this._standAloneConfigurations)}getUnsupportedKeys(){return[]}}class ie extends h.JT{constructor(e,t,i,r,o,s,a,c,h){super(),this.workspaceFolder=t,this.workbenchState=r,this.workspaceTrusted=o,this.configurationCache=h,this._onDidChange=this._register(new n.Q5),this.onDidChange=this._onDidChange.event,this.scopes=3===this.workbenchState?m.ao:m.G,this.configurationFolder=a.extUri.joinPath(t.uri,i),this.cachedFolderConfiguration=new te(t.uri,i,{scopes:this.scopes,skipRestricted:this.isUntrusted()},h),e&&this.configurationCache.needsCaching(t.uri)?(this.folderConfiguration=this.cachedFolderConfiguration,(0,R.vP)(t.uri,s).then((()=>{this.folderConfiguration=this._register(this.createFileServiceBasedConfiguration(s,a,c)),this._register(this.folderConfiguration.onDidChange((e=>this.onDidFolderConfigurationChange()))),this.onDidFolderConfigurationChange()}))):(this.folderConfiguration=this._register(this.createFileServiceBasedConfiguration(s,a,c)),this._register(this.folderConfiguration.onDidChange((e=>this.onDidFolderConfigurationChange()))))}loadConfiguration(){return this.folderConfiguration.loadConfiguration()}updateWorkspaceTrust(e){return this.workspaceTrusted=e,this.reparse()}reparse(){const e=this.folderConfiguration.reparse({scopes:this.scopes,skipRestricted:this.isUntrusted()});return this.updateCache(),e}getRestrictedSettings(){return this.folderConfiguration.getRestrictedSettings()}isUntrusted(){return!this.workspaceTrusted}onDidFolderConfigurationChange(){this.updateCache(),this._onDidChange.fire()}createFileServiceBasedConfiguration(e,t,i){const r=t.extUri.joinPath(this.configurationFolder,`${m.l3}.json`),o=[m.QN,m.Bf].map((e=>[e,t.extUri.joinPath(this.configurationFolder,`${e}.json`)]));return new Y(this.configurationFolder.toString(),r,o,{scopes:this.scopes,skipRestricted:this.isUntrusted()},e,t,i)}async updateCache(){if(this.configurationCache.needsCaching(this.configurationFolder)&&this.folderConfiguration instanceof Y){const[e,t]=await this.folderConfiguration.resolveContents();this.cachedFolderConfiguration.updateConfiguration(e,t)}}}var re=i(14117),oe=i(78787),se=i(63809),ne=i(22384),ae=i(59523),ce=i(33425),he=i(12021),ue=i(35459),ge=i(76076),le=i(78244),de=i(36243);function fe(e,t){return e.isDefault?t?m.eZ:void 0:t?m.qz:m.eS}class pe extends l.j${constructor(){super(...arguments),this.initialized=!1}}class Ce extends h.JT{get restrictedSettings(){return this._restrictedSettings}constructor({remoteAuthority:e,configurationCache:t},i,r,o,s,c,g,l,f){if(super(),this.userDataProfileService=r,this.userDataProfilesService=o,this.fileService=s,this.remoteAgentService=c,this.uriIdentityService=g,this.logService=l,this.initialized=!1,this.applicationConfiguration=null,this.remoteUserConfiguration=null,this._onDidChangeConfiguration=this._register(new n.Q5),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._onWillChangeWorkspaceFolders=this._register(new n.Q5),this.onWillChangeWorkspaceFolders=this._onWillChangeWorkspaceFolders.event,this._onDidChangeWorkspaceFolders=this._register(new n.Q5),this.onDidChangeWorkspaceFolders=this._onDidChangeWorkspaceFolders.event,this._onDidChangeWorkspaceName=this._register(new n.Q5),this.onDidChangeWorkspaceName=this._onDidChangeWorkspaceName.event,this._onDidChangeWorkbenchState=this._register(new n.Q5),this.onDidChangeWorkbenchState=this._onDidChangeWorkbenchState.event,this.isWorkspaceTrusted=!0,this._restrictedSettings={default:[]},this._onDidChangeRestrictedSettings=this._register(new n.Q5),this.onDidChangeRestrictedSettings=this._onDidChangeRestrictedSettings.event,this.configurationRegistry=y.B.as(_.IP.Configuration),this.initRemoteUserConfigurationBarrier=new u.U8,this.completeWorkspaceBarrier=new u.U8,this.defaultConfiguration=this._register(new B(t,i)),this.policyConfiguration=f instanceof ge.j7?new p.ET:this._register(new p.im(this.defaultConfiguration,f,l)),this.configurationCache=t,this._configuration=new S(this.defaultConfiguration.configurationModel,this.policyConfiguration.configurationModel,new d.VV,new d.VV,new d.VV,new d.VV,new a.Y9,new d.VV,new a.Y9,this.workspace),this.applicationConfigurationDisposables=this._register(new h.SL),this.createApplicationConfiguration(),this.localUserConfiguration=this._register(new J(r.currentProfile.settingsResource,r.currentProfile.tasksResource,{scopes:fe(r.currentProfile,!!e)},s,g,l)),this.cachedFolderConfigs=new a.Y9,this._register(this.localUserConfiguration.onDidChangeConfiguration((e=>this.onLocalUserConfigurationChanged(e)))),e){const i=this.remoteUserConfiguration=this._register(new Q(e,t,s,g,c));this._register(i.onDidInitialize((e=>{this._register(i.onDidChangeConfiguration((e=>this.onRemoteUserConfigurationChanged(e)))),this.onRemoteUserConfigurationChanged(e),this.initRemoteUserConfigurationBarrier.open()})))}else this.initRemoteUserConfigurationBarrier.open();this.workspaceConfiguration=this._register(new X(t,s,g,l)),this._register(this.workspaceConfiguration.onDidUpdateConfiguration((e=>{this.onWorkspaceConfigurationChanged(e).then((()=>{this.workspace.initialized=this.workspaceConfiguration.initialized,this.checkAndMarkWorkspaceComplete(e)}))}))),this._register(this.defaultConfiguration.onDidChangeConfiguration((({properties:e,defaults:t})=>this.onDefaultConfigurationChanged(t,e)))),this._register(this.policyConfiguration.onDidChangeConfiguration((e=>this.onPolicyConfigurationChanged(e)))),this._register(r.onDidChangeCurrentProfile((e=>this.onUserDataProfileChanged(e)))),this.workspaceEditingQueue=new u.ci}createApplicationConfiguration(){this.applicationConfigurationDisposables.clear(),this.userDataProfileService.currentProfile.isDefault||this.userDataProfileService.currentProfile.useDefaultFlags?.settings?this.applicationConfiguration=null:(this.applicationConfiguration=this.applicationConfigurationDisposables.add(this._register(new q(this.userDataProfilesService,this.fileService,this.uriIdentityService))),this.applicationConfigurationDisposables.add(this.applicationConfiguration.onDidChangeConfiguration((e=>this.onApplicationConfigurationChanged(e)))))}async getCompleteWorkspace(){return await this.completeWorkspaceBarrier.wait(),this.getWorkspace()}getWorkspace(){return this.workspace}getWorkbenchState(){return this.workspace.configuration?3:1===this.workspace.folders.length?2:1}getWorkspaceFolder(e){return this.workspace.getFolder(e)}addFolders(e,t){return this.updateFolders(e,[],t)}removeFolders(e){return this.updateFolders([],e)}async updateFolders(e,t,i){return this.workspaceEditingQueue.queue((()=>this.doUpdateFolders(e,t,i)))}isInsideWorkspace(e){return!!this.getWorkspaceFolder(e)}isCurrentWorkspace(e){switch(this.getWorkbenchState()){case 2:{let t;return s.ov.isUri(e)?t=e:(0,l.eb)(e)&&(t=e.uri),s.ov.isUri(t)&&this.uriIdentityService.extUri.isEqual(t,this.workspace.folders[0].uri)}case 3:return(0,l.NI)(e)&&this.workspace.id===e.id}return!1}async doUpdateFolders(e,t,i){if(3!==this.getWorkbenchState())return Promise.resolve(void 0);if(e.length+t.length===0)return Promise.resolve(void 0);let r=!1,o=this.getWorkspace().folders,s=o.map((e=>e.raw)).filter(((e,i)=>!(0,b.S$)(e)||!this.contains(t,o[i].uri)));if(r=o.length!==s.length,e.length){const t=this.getWorkspace().configuration,n=this.uriIdentityService.extUri.dirname(t);o=(0,b.UD)(s,t,this.uriIdentityService.extUri);const a=o.map((e=>e.uri)),c=[];for(const t of e){const e=t.uri;if(!this.contains(a,e)){try{if(!(await this.fileService.stat(e)).isDirectory)continue}catch(e){}c.push((0,b.l0)(e,!1,t.name,n,this.uriIdentityService.extUri))}}c.length>0&&(r=!0,"number"==typeof i&&i>=0&&i<s.length?(s=s.slice(0),s.splice(i,0,...c)):s=[...s,...c])}return r?this.setFolders(s):Promise.resolve(void 0)}async setFolders(e){if(!this.instantiationService)throw new Error("Cannot update workspace folders because workspace service is not yet ready to accept writes.");return await this.instantiationService.invokeFunction((t=>this.workspaceConfiguration.setFolders(e,t.get(le.R)))),this.onWorkspaceConfigurationChanged(!1)}contains(e,t){return e.some((e=>this.uriIdentityService.extUri.isEqual(e,t)))}getConfigurationData(){return this._configuration.toData()}getValue(e,t){const i="string"==typeof e?e:void 0,r=(0,f.Rw)(e)?e:(0,f.Rw)(t)?t:void 0;return this._configuration.getValue(i,r)}async updateValue(e,t,i,r,o){const s=(0,f.BG)(i)?i:(0,f.Rw)(i)?{resource:i.resource,overrideIdentifiers:i.overrideIdentifier?[i.overrideIdentifier]:void 0}:void 0,n=s?r:i,a=n?[n]:[];if(s?.overrideIdentifiers&&(s.overrideIdentifiers=(0,w.EB)(s.overrideIdentifiers),s.overrideIdentifiers=s.overrideIdentifiers.length?s.overrideIdentifiers:void 0),!a.length){if(s?.overrideIdentifiers&&s.overrideIdentifiers.length>1)throw new Error("Configuration Target is required while updating the value for multiple override identifiers");const i=this.inspect(e,{resource:s?.resource,overrideIdentifier:s?.overrideIdentifiers?s.overrideIdentifiers[0]:void 0});a.push(...this.deriveConfigurationTargets(e,t,i)),!(0,c.fS)(t,i.defaultValue)||1!==a.length||2!==a[0]&&3!==a[0]||(t=void 0)}await u.jT.settled(a.map((i=>this.writeConfigurationValue(e,t,i,s,o))))}async reloadConfiguration(e){if(void 0===e){this.reloadDefaultConfiguration();const e=await this.reloadApplicationConfiguration(!0),{local:t,remote:i}=await this.reloadUserConfiguration();return await this.reloadWorkspaceConfiguration(),void await this.loadConfiguration(e,t,i,!0)}if((0,l.dV)(e))await this.reloadWorkspaceFolderConfiguration(e);else switch(e){case 7:return void this.reloadDefaultConfiguration();case 2:{const{local:e,remote:t}=await this.reloadUserConfiguration();return void await this.loadConfiguration(this._configuration.applicationConfiguration,e,t,!0)}case 3:return void await this.reloadLocalUserConfiguration();case 4:return void await this.reloadRemoteUserConfiguration();case 5:case 6:return void await this.reloadWorkspaceConfiguration()}}hasCachedConfigurationDefaultsOverrides(){return this.defaultConfiguration.hasCachedConfigurationDefaultsOverrides()}inspect(e,t){return this._configuration.inspect(e,t)}keys(){return this._configuration.keys()}async whenRemoteConfigurationLoaded(){await this.initRemoteUserConfigurationBarrier.wait()}async initialize(e){(0,re.B)("code/willInitWorkspaceService");const t=this.initialized;this.initialized=!1;const i=await this.createWorkspace(e);await this.updateWorkspaceAndInitializeConfiguration(i,t),this.checkAndMarkWorkspaceComplete(!1),(0,re.B)("code/didInitWorkspaceService")}updateWorkspaceTrust(e){if(this.isWorkspaceTrusted!==e){this.isWorkspaceTrusted=e;const t=this._configuration.toData(),i=[];for(const e of this.workspace.folders){const t=this.cachedFolderConfigs.get(e.uri);let r;t&&(r=t.updateWorkspaceTrust(this.isWorkspaceTrusted),this._configuration.updateFolderConfiguration(e.uri,r)),i.push(r)}2===this.getWorkbenchState()?i[0]&&this._configuration.updateWorkspaceConfiguration(i[0]):this._configuration.updateWorkspaceConfiguration(this.workspaceConfiguration.updateWorkspaceTrust(this.isWorkspaceTrusted)),this.updateRestrictedSettings();let r=[];this.restrictedSettings.userLocal&&r.push(...this.restrictedSettings.userLocal),this.restrictedSettings.userRemote&&r.push(...this.restrictedSettings.userRemote),this.restrictedSettings.workspace&&r.push(...this.restrictedSettings.workspace),this.restrictedSettings.workspaceFolder?.forEach((e=>r.push(...e))),r=(0,w.EB)(r),r.length&&this.triggerConfigurationChange({keys:r,overrides:[]},{data:t,workspace:this.workspace},5)}}acquireInstantiationService(e){this.instantiationService=e}isSettingAppliedForAllProfiles(e){if(1===this.configurationRegistry.getConfigurationProperties()[e]?.scope)return!0;const t=this.getValue(m.ek)??[];return Array.isArray(t)&&t.includes(e)}async createWorkspace(e){return(0,l.NI)(e)?this.createMultiFolderWorkspace(e):(0,l.eb)(e)?this.createSingleFolderWorkspace(e):this.createEmptyWorkspace(e)}async createMultiFolderWorkspace(e){await this.workspaceConfiguration.initialize({id:e.id,configPath:e.configPath},this.isWorkspaceTrusted);const t=e.configPath,i=(0,b.UD)(this.workspaceConfiguration.getFolders(),t,this.uriIdentityService.extUri),r=e.id,o=new pe(r,i,this.workspaceConfiguration.isTransient(),t,(e=>this.uriIdentityService.extUri.ignorePathCasing(e)));return o.initialized=this.workspaceConfiguration.initialized,o}createSingleFolderWorkspace(e){const t=new pe(e.id,[(0,l.fY)(e.uri)],!1,null,(e=>this.uriIdentityService.extUri.ignorePathCasing(e)));return t.initialized=!0,t}createEmptyWorkspace(e){const t=new pe(e.id,[],!1,null,(e=>this.uriIdentityService.extUri.ignorePathCasing(e)));return t.initialized=!0,Promise.resolve(t)}checkAndMarkWorkspaceComplete(e){!this.completeWorkspaceBarrier.isOpen()&&this.workspace.initialized&&(this.completeWorkspaceBarrier.open(),this.validateWorkspaceFoldersAndReload(e))}async updateWorkspaceAndInitializeConfiguration(e,t){const i=!!this.workspace;let r,o,s=[];if(i?(r=this.getWorkbenchState(),o=this.workspace.configuration?this.workspace.configuration.fsPath:void 0,s=this.workspace.folders,this.workspace.update(e)):this.workspace=e,await this.initializeConfiguration(t),i){const e=this.getWorkbenchState();r&&e!==r&&this._onDidChangeWorkbenchState.fire(e);const t=this.workspace.configuration?this.workspace.configuration.fsPath:void 0;(o&&t!==o||e!==r)&&this._onDidChangeWorkspaceName.fire();const i=this.compareFolders(s,this.workspace.folders);i&&(i.added.length||i.removed.length||i.changed.length)&&(await this.handleWillChangeWorkspaceFolders(i,!1),this._onDidChangeWorkspaceFolders.fire(i))}this.localUserConfiguration.hasTasksLoaded||this._register((0,u.To)((()=>this.reloadLocalUserConfiguration())))}compareFolders(e,t){const i={added:[],removed:[],changed:[]};i.added=t.filter((t=>!e.some((e=>t.uri.toString()===e.uri.toString()))));for(let r=0;r<e.length;r++){const o=e[r];let s=0;for(s=0;s<t.length&&o.uri.toString()!==t[s].uri.toString();s++);s<t.length?r===s&&o.name===t[s].name||i.changed.push(o):i.removed.push(o)}return i}async initializeConfiguration(e){await this.defaultConfiguration.initialize();const t=this.policyConfiguration.initialize(),i=this.applicationConfiguration?this.applicationConfiguration.initialize():Promise.resolve(new d.VV),[,r,[o,s]]=await Promise.all([t,i,(async()=>{(0,re.B)("code/willInitUserConfiguration");const e=await Promise.all([this.localUserConfiguration.initialize(),this.remoteUserConfiguration?this.remoteUserConfiguration.initialize():Promise.resolve(new d.VV)]);if(this.applicationConfiguration){const t=await i;e[0]=this.localUserConfiguration.reparse({exclude:t.getValue(m.ek)})}return(0,re.B)("code/didInitUserConfiguration"),e})()]);(0,re.B)("code/willInitWorkspaceConfiguration"),await this.loadConfiguration(r,o,s,e),(0,re.B)("code/didInitWorkspaceConfiguration")}reloadDefaultConfiguration(){this.onDefaultConfigurationChanged(this.defaultConfiguration.reload())}async reloadApplicationConfiguration(e){if(!this.applicationConfiguration)return new d.VV;const t=await this.applicationConfiguration.loadConfiguration();return e||this.onApplicationConfigurationChanged(t),t}async reloadUserConfiguration(){const[e,t]=await Promise.all([this.reloadLocalUserConfiguration(!0),this.reloadRemoteUserConfiguration(!0)]);return{local:e,remote:t}}async reloadLocalUserConfiguration(e){const t=await this.localUserConfiguration.reload();return e||this.onLocalUserConfigurationChanged(t),t}async reloadRemoteUserConfiguration(e){if(this.remoteUserConfiguration){const t=await this.remoteUserConfiguration.reload();return e||this.onRemoteUserConfigurationChanged(t),t}return new d.VV}async reloadWorkspaceConfiguration(){const e=this.getWorkbenchState();return 2===e?this.onWorkspaceFolderConfigurationChanged(this.workspace.folders[0]):3===e?this.workspaceConfiguration.reload().then((()=>this.onWorkspaceConfigurationChanged(!1))):void 0}reloadWorkspaceFolderConfiguration(e){return this.onWorkspaceFolderConfigurationChanged(e)}async loadConfiguration(e,t,i,r){this.cachedFolderConfigs=new a.Y9;const o=this.workspace.folders,s=await this.loadFolderConfigurations(o),n=this.getWorkspaceConfigurationModel(s),c=new a.Y9;s.forEach(((e,t)=>c.set(o[t].uri,e)));const h=this._configuration;if(this._configuration=new S(this.defaultConfiguration.configurationModel,this.policyConfiguration.configurationModel,e,t,i,n,c,new d.VV,new a.Y9,this.workspace),this.initialized=!0,r){const e=this._configuration.compare(h);this.triggerConfigurationChange(e,{data:h.toData(),workspace:this.workspace},5)}this.updateRestrictedSettings()}getWorkspaceConfigurationModel(e){switch(this.getWorkbenchState()){case 2:return e[0];case 3:return this.workspaceConfiguration.getConfiguration();default:return new d.VV}}onUserDataProfileChanged(e){e.join((async()=>{const t=[];t.push(this.localUserConfiguration.reset(e.profile.settingsResource,e.profile.tasksResource,{scopes:fe(e.profile,!!this.remoteUserConfiguration)})),e.previous.isDefault===e.profile.isDefault&&!!e.previous.useDefaultFlags?.settings==!!e.profile.useDefaultFlags?.settings||(this.createApplicationConfiguration(),this.applicationConfiguration&&t.push(this.reloadApplicationConfiguration(!0)));let[i,r]=await Promise.all(t);r=r??this._configuration.applicationConfiguration,this.applicationConfiguration&&(i=this.localUserConfiguration.reparse({exclude:r.getValue(m.ek)})),await this.loadConfiguration(r,i,this._configuration.remoteUserConfiguration,!0)})())}onDefaultConfigurationChanged(e,t){if(this.workspace){const i=this._configuration.toData(),r=this._configuration.compareAndUpdateDefaultConfiguration(e,t);if(this.applicationConfiguration&&this._configuration.updateApplicationConfiguration(this.applicationConfiguration.reparse()),this.remoteUserConfiguration&&(this._configuration.updateLocalUserConfiguration(this.localUserConfiguration.reparse()),this._configuration.updateRemoteUserConfiguration(this.remoteUserConfiguration.reparse())),2===this.getWorkbenchState()){const e=this.cachedFolderConfigs.get(this.workspace.folders[0].uri);e&&(this._configuration.updateWorkspaceConfiguration(e.reparse()),this._configuration.updateFolderConfiguration(this.workspace.folders[0].uri,e.reparse()))}else{this._configuration.updateWorkspaceConfiguration(this.workspaceConfiguration.reparseWorkspaceSettings());for(const e of this.workspace.folders){const t=this.cachedFolderConfigs.get(e.uri);t&&this._configuration.updateFolderConfiguration(e.uri,t.reparse())}}this.triggerConfigurationChange(r,{data:i,workspace:this.workspace},7),this.updateRestrictedSettings()}}onPolicyConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdatePolicyConfiguration(e);this.triggerConfigurationChange(i,t,7)}onApplicationConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.applicationConfiguration.getValue(m.ek)??[],r=this._configuration.compareAndUpdateApplicationConfiguration(e),o=this.getValue(m.ek)??[],s=this.configurationRegistry.getConfigurationProperties(),n=[];for(const e of r.keys)if(1===s[e]?.scope){if(n.push(e),e===m.ek){for(const e of i)o.includes(e)||n.push(e);for(const e of o)i.includes(e)||n.push(e)}}else o.includes(e)&&n.push(e);r.keys=n,r.keys.includes(m.ek)&&this._configuration.updateLocalUserConfiguration(this.localUserConfiguration.reparse({exclude:o})),this.triggerConfigurationChange(r,t,2)}onLocalUserConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdateLocalUserConfiguration(e);this.triggerConfigurationChange(i,t,2)}onRemoteUserConfigurationChanged(e){const t={data:this._configuration.toData(),workspace:this.workspace},i=this._configuration.compareAndUpdateRemoteUserConfiguration(e);this.triggerConfigurationChange(i,t,2)}async onWorkspaceConfigurationChanged(e){if(this.workspace&&this.workspace.configuration){let t=(0,b.UD)(this.workspaceConfiguration.getFolders(),this.workspace.configuration,this.uriIdentityService.extUri);if(this.workspace.initialized){const{added:e,removed:i,changed:r}=this.compareFolders(this.workspace.folders,t);t=e.length||i.length||r.length?await this.toValidWorkspaceFolders(t):this.workspace.folders}await this.updateWorkspaceConfiguration(t,this.workspaceConfiguration.getConfiguration(),e)}}updateRestrictedSettings(){const e=[],t=this.configurationRegistry.getConfigurationProperties(),i=Object.keys(t).filter((e=>t[e].restricted)).sort(((e,t)=>e.localeCompare(t))),r=(0,w.pY)(i,this._restrictedSettings.default,((e,t)=>e.localeCompare(t)));e.push(...r.added,...r.removed);const o=(this.applicationConfiguration?.getRestrictedSettings()||[]).sort(((e,t)=>e.localeCompare(t))),s=(0,w.pY)(o,this._restrictedSettings.application||[],((e,t)=>e.localeCompare(t)));e.push(...s.added,...s.removed);const n=this.localUserConfiguration.getRestrictedSettings().sort(((e,t)=>e.localeCompare(t))),c=(0,w.pY)(n,this._restrictedSettings.userLocal||[],((e,t)=>e.localeCompare(t)));e.push(...c.added,...c.removed);const h=(this.remoteUserConfiguration?.getRestrictedSettings()||[]).sort(((e,t)=>e.localeCompare(t))),u=(0,w.pY)(h,this._restrictedSettings.userRemote||[],((e,t)=>e.localeCompare(t)));e.push(...u.added,...u.removed);const g=new a.Y9;for(const t of this.workspace.folders){const i=this.cachedFolderConfigs.get(t.uri),r=(i?.getRestrictedSettings()||[]).sort(((e,t)=>e.localeCompare(t)));r.length&&g.set(t.uri,r);const o=this._restrictedSettings.workspaceFolder?.get(t.uri)||[],s=(0,w.pY)(r,o,((e,t)=>e.localeCompare(t)));e.push(...s.added,...s.removed)}const l=3===this.getWorkbenchState()?this.workspaceConfiguration.getRestrictedSettings().sort(((e,t)=>e.localeCompare(t))):this.workspace.folders[0]&&g.get(this.workspace.folders[0].uri)||[],d=(0,w.pY)(l,this._restrictedSettings.workspace||[],((e,t)=>e.localeCompare(t)));e.push(...d.added,...d.removed),e.length&&(this._restrictedSettings={default:i,application:o.length?o:void 0,userLocal:n.length?n:void 0,userRemote:h.length?h:void 0,workspace:l.length?l:void 0,workspaceFolder:g.size?g:void 0},this._onDidChangeRestrictedSettings.fire(this.restrictedSettings))}async updateWorkspaceConfiguration(e,t,i){const r={data:this._configuration.toData(),workspace:this.workspace},o=this._configuration.compareAndUpdateWorkspaceConfiguration(t),s=this.compareFolders(this.workspace.folders,e);if(s.added.length||s.removed.length||s.changed.length){this.workspace.folders=e;const t=await this.onFoldersChanged();await this.handleWillChangeWorkspaceFolders(s,i),this.triggerConfigurationChange(t,r,6),this._onDidChangeWorkspaceFolders.fire(s)}else this.triggerConfigurationChange(o,r,5);this.updateRestrictedSettings()}async handleWillChangeWorkspaceFolders(e,t){const i=[];this._onWillChangeWorkspaceFolders.fire({join(e){i.push(e)},changes:e,fromCache:t});try{await u.jT.settled(i)}catch(e){}}async onWorkspaceFolderConfigurationChanged(e){const[t]=await this.loadFolderConfigurations([e]),i={data:this._configuration.toData(),workspace:this.workspace},r=this._configuration.compareAndUpdateFolderConfiguration(e.uri,t);if(2===this.getWorkbenchState()){const e=this._configuration.compareAndUpdateWorkspaceConfiguration(t);this.triggerConfigurationChange((0,d.nP)(r,e),i,5)}else this.triggerConfigurationChange(r,i,6);this.updateRestrictedSettings()}async onFoldersChanged(){const e=[];for(const t of this.cachedFolderConfigs.keys())this.workspace.folders.filter((e=>e.uri.toString()===t.toString()))[0]||(this.cachedFolderConfigs.get(t).dispose(),this.cachedFolderConfigs.delete(t),e.push(this._configuration.compareAndDeleteFolderConfiguration(t)));const t=this.workspace.folders.filter((e=>!this.cachedFolderConfigs.has(e.uri)));return t.length&&(await this.loadFolderConfigurations(t)).forEach(((i,r)=>{e.push(this._configuration.compareAndUpdateFolderConfiguration(t[r].uri,i))})),(0,d.nP)(...e)}loadFolderConfigurations(e){return Promise.all([...e.map((e=>{let t=this.cachedFolderConfigs.get(e.uri);return t||(t=new ie(!this.initialized,e,m.Nj,this.getWorkbenchState(),this.isWorkspaceTrusted,this.fileService,this.uriIdentityService,this.logService,this.configurationCache),this._register(t.onDidChange((()=>this.onWorkspaceFolderConfigurationChanged(e)))),this.cachedFolderConfigs.set(e.uri,this._register(t))),t.loadConfiguration()}))])}async validateWorkspaceFoldersAndReload(e){const t=await this.toValidWorkspaceFolders(this.workspace.folders),{removed:i}=this.compareFolders(this.workspace.folders,t);i.length&&await this.updateWorkspaceConfiguration(t,this.workspaceConfiguration.getConfiguration(),e)}async toValidWorkspaceFolders(e){const t=[];for(const i of e){try{if(!(await this.fileService.stat(i.uri)).isDirectory)continue}catch(e){this.logService.warn(`Ignoring the error while validating workspace folder ${i.uri.toString()} - ${(0,ae.yJ)(e)}`)}t.push(i)}return t}async writeConfigurationValue(e,t,i,r,o){if(!this.instantiationService)throw new Error("Cannot write configuration because the configuration service is not yet ready to accept writes.");if(7===i)throw new Error("Invalid configuration target");if(8===i){const o={data:this._configuration.toData(),workspace:this.workspace};return this._configuration.updateValue(e,t,r),void this.triggerConfigurationChange({keys:r?.overrideIdentifiers?.length?[(0,_.np)(r.overrideIdentifiers),e]:[e],overrides:r?.overrideIdentifiers?.length?r.overrideIdentifiers.map((t=>[t,[e]])):[]},o,i)}const s=this.toEditableConfigurationTarget(i,e);if(!s)throw new Error("Invalid configuration target");if(2===s&&!this.remoteUserConfiguration)throw new Error("Invalid configuration target");switch(this.configurationEditing=this.configurationEditing??this.instantiationService.createInstance(j,(await this.remoteAgentService.getEnvironment())?.settingsPath??null),await this.configurationEditing.writeConfiguration(s,{key:e,value:t},{scopes:r,...o}),s){case 1:return void(this.applicationConfiguration&&this.isSettingAppliedForAllProfiles(e)?await this.reloadApplicationConfiguration():await this.reloadLocalUserConfiguration());case 2:return this.reloadRemoteUserConfiguration().then((()=>{}));case 3:return this.reloadWorkspaceConfiguration();case 4:{const e=r&&r.resource?this.workspace.getFolder(r.resource):null;if(e)return this.reloadWorkspaceFolderConfiguration(e)}}}deriveConfigurationTargets(e,t,i){if((0,c.fS)(t,i.value))return[];const r=[];return void 0!==i.workspaceFolderValue&&r.push(6),void 0!==i.workspaceValue&&r.push(5),void 0!==i.userRemoteValue&&r.push(4),void 0!==i.userLocalValue&&r.push(3),void 0===t?r:[r[0]||2]}triggerConfigurationChange(e,t,i){if(e.keys.length){7!==i&&this.logService.debug(`Configuration keys changed in ${(0,f.xV)(i)} target`,...e.keys);const r=new d.YX(e,t,this._configuration,this.workspace);r.source=i,r.sourceConfig=this.getTargetConfiguration(i),this._onDidChangeConfiguration.fire(r)}}getTargetConfiguration(e){switch(e){case 7:return this._configuration.defaults.contents;case 2:return this._configuration.userConfiguration.contents;case 5:return this._configuration.workspaceConfiguration.contents}return{}}toEditableConfigurationTarget(e,t){if(2===e){if(this.remoteUserConfiguration){const e=this.configurationRegistry.getConfigurationProperties()[t]?.scope;if(2===e||6===e)return 2;if(void 0!==this.inspect(t).userRemoteValue)return 2}return 1}return 3===e?1:4===e?2:5===e?3:6===e?4:null}}let we=class extends h.JT{constructor(e,t,i,r,o){super(),this.workspaceContextService=e,this.environmentService=t,this.workspaceTrustManagementService=i,r.whenInstalledExtensionsRegistered().then((()=>{this.registerConfigurationSchemas();const e=y.B.as(_.IP.Configuration),t=this._register(new u.vp(50));this._register(n.ju.any(e.onDidUpdateConfiguration,e.onDidSchemaChange,i.onDidChangeTrust)((()=>t.trigger((()=>this.registerConfigurationSchemas()),4===o.phase?void 0:2500))))}))}registerConfigurationSchemas(){const e={properties:_.zt.properties,patternProperties:_.zt.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},t=this.environmentService.remoteAuthority?{properties:Object.assign({},_.w_.properties,_.dy.properties,_.Vn.properties),patternProperties:_.zt.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0}:e,i={properties:Object.assign({},_.V2.properties,_.iq.properties,_.dy.properties,_.Vn.properties),patternProperties:_.zt.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},r={properties:Object.assign({},_.V2.properties,_.iq.properties,_.dy.properties,_.Vn.properties),patternProperties:_.zt.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},o={properties:Object.assign({},this.checkAndFilterPropertiesRequiringTrust(_.iq.properties),this.checkAndFilterPropertiesRequiringTrust(_.dy.properties),this.checkAndFilterPropertiesRequiringTrust(_.Vn.properties)),patternProperties:_.zt.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},s={properties:Object.keys(_.zt.properties).reduce(((e,t)=>(e[t]=Object.assign({deprecationMessage:void 0},_.zt.properties[t]),e)),{}),patternProperties:Object.keys(_.zt.patternProperties).reduce(((e,t)=>(e[t]=Object.assign({deprecationMessage:void 0},_.zt.patternProperties[t]),e)),{}),additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},n=3===this.workspaceContextService.getWorkbenchState()?{properties:Object.assign({},this.checkAndFilterPropertiesRequiringTrust(_.iq.properties),this.checkAndFilterPropertiesRequiringTrust(_.Vn.properties)),patternProperties:_.zt.patternProperties,additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0}:o,a={type:"object",description:(0,W.NC)("configurationDefaults.description","Contribute defaults for configurations"),properties:Object.assign({},_.iq.properties,_.dy.properties,_.Vn.properties),patternProperties:{[_.G1]:{type:"object",default:{},$ref:_.NJ}},additionalProperties:!1};this.registerSchemas({defaultSettingsSchema:s,userSettingsSchema:t,profileSettingsSchema:i,machineSettingsSchema:r,workspaceSettingsSchema:o,folderSettingsSchema:n,configDefaultsSchema:a})}registerSchemas(e){const t=y.B.as(g.I.JSONContribution);t.registerSchema(m.$S,e.defaultSettingsSchema),t.registerSchema(m.v7,e.userSettingsSchema),t.registerSchema(m.nT,e.profileSettingsSchema),t.registerSchema(m.at,e.machineSettingsSchema),t.registerSchema(m.oL,e.workspaceSettingsSchema),t.registerSchema(m.p7,e.folderSettingsSchema),t.registerSchema(_.Tk,e.configDefaultsSchema)}checkAndFilterPropertiesRequiringTrust(e){if(this.workspaceTrustManagementService.isWorkspaceTrusted())return e;const t={};return Object.entries(e).forEach((([e,i])=>{i.restricted||(t[e]=i)})),t}};we=(0,r.g)([(0,r.f)(0,l.ec),(0,r.f)(1,oe.n),(0,r.f)(2,ce.Y2),(0,r.f)(3,he.QS),(0,r.f)(4,ne.g)],we);let ve=class extends h.JT{constructor(e){super(),this.workbenchAssignmentService=e,this.processedExperimentalSettings=new Set,this.configurationRegistry=y.B.as(_.IP.Configuration),this.processExperimentalSettings(Object.keys(this.configurationRegistry.getConfigurationProperties())),this._register(this.configurationRegistry.onDidUpdateConfiguration((({properties:e})=>this.processExperimentalSettings(e))))}async processExperimentalSettings(e){const t={},i=this.configurationRegistry.getConfigurationProperties();for(const r of e){const e=i[r];if(e?.tags?.includes("experimental")&&!this.processedExperimentalSettings.has(r)){this.processedExperimentalSettings.add(r);try{const i=await this.workbenchAssignmentService.getTreatment(`config.${r}`);(0,C.o8)(i)||(0,c.fS)(i,e.default)||(t[r]=i)}catch(e){}}}Object.keys(t).length&&this.configurationRegistry.registerDefaultConfigurations([{overrides:t,source:(0,W.NC)("experimental","Experiments")}])}};ve=(0,r.g)([(0,r.f)(0,ue.U)],ve);const ke=y.B.as(se.I.Workbench);ke.registerWorkbenchContribution(we,3),ke.registerWorkbenchContribution(ve,3),y.B.as(_.IP.Configuration).registerConfiguration({...de.p6,properties:{[m.ek]:{type:"array",description:(0,W.NC)("setting description","Configure settings to be applied for all profiles."),default:[],scope:1,additionalProperties:!0,uniqueItems:!0}}});var Se=i(71765),me=i(50187),ye=i(72042),_e=i(73733);let be=class extends h.JT{constructor(e,t,i){super(),this.configurationService=e,this.modelService=t,this.languageService=i,this._onDidChangeConfiguration=this._register(new n.Q5),this.onDidChangeConfiguration=this._onDidChangeConfiguration.event,this._register(this.configurationService.onDidChangeConfiguration((e=>this._onDidChangeConfiguration.fire(this.toResourceConfigurationChangeEvent(e)))))}getValue(e,t,i){return"string"==typeof i?this._getValue(e,me.L.isIPosition(t)?t:null,i):this._getValue(e,null,"string"==typeof t?t:void 0)}updateValue(e,t,i,r){const o=this.getLanguage(e,null),s=this.configurationService.inspect(t,{resource:e,overrideIdentifier:o});switch(void 0===r&&(r=this.deriveConfigurationTarget(s,o)),r){case 8:return this._updateValue(t,i,r,s.memory?.override,e,o);case 6:return this._updateValue(t,i,r,s.workspaceFolder?.override,e,o);case 5:return this._updateValue(t,i,r,s.workspace?.override,e,o);case 4:return this._updateValue(t,i,r,s.userRemote?.override,e,o);default:return this._updateValue(t,i,r,s.userLocal?.override,e,o)}}_updateValue(e,t,i,r,o,s){return s&&void 0!==r?this.configurationService.updateValue(e,t,{resource:o,overrideIdentifier:s},i):this.configurationService.updateValue(e,t,{resource:o},i)}deriveConfigurationTarget(e,t){if(t){if(void 0!==e.memory?.override)return 8;if(void 0!==e.workspaceFolder?.override)return 6;if(void 0!==e.workspace?.override)return 5;if(void 0!==e.userRemote?.override)return 4;if(void 0!==e.userLocal?.override)return 3}return void 0!==e.memory?.value?8:void 0!==e.workspaceFolder?.value?6:void 0!==e.workspace?.value?5:void 0!==e.userRemote?.value?4:3}_getValue(e,t,i){const r=e?this.getLanguage(e,t):void 0;return void 0===i?this.configurationService.getValue({resource:e,overrideIdentifier:r}):this.configurationService.getValue(i,{resource:e,overrideIdentifier:r})}inspect(e,t,i){const r=e?this.getLanguage(e,t):void 0;return this.configurationService.inspect(i,{resource:e,overrideIdentifier:r})}getLanguage(e,t){const i=this.modelService.getModel(e);return i?t?i.getLanguageIdAtPosition(t.lineNumber,t.column):i.getLanguageId():this.languageService.guessLanguageIdByFilepathOrFirstLine(e)}toResourceConfigurationChangeEvent(e){return{affectedKeys:e.affectedKeys,affectsConfiguration:(t,i)=>{const r=t?this.getLanguage(t,null):void 0;return e.affectsConfiguration(i,{resource:t,overrideIdentifier:r})}}}};be=(0,r.g)([(0,r.f)(0,f.Ui),(0,r.f)(1,_e.q),(0,r.f)(2,ye.O)],be);var We,De=i(97108);!function(e){e[e.APPLICATION=1]="APPLICATION",e[e.MACHINE=2]="MACHINE",e[e.WINDOW=3]="WINDOW",e[e.RESOURCE=4]="RESOURCE",e[e.LANGUAGE_OVERRIDABLE=5]="LANGUAGE_OVERRIDABLE",e[e.MACHINE_OVERRIDABLE=6]="MACHINE_OVERRIDABLE"}(We||(We={}));var Fe=i(53060),Pe=i(43557),Re=i(72065),Ue=i(43459);class Ie{constructor(e,t,i){this.donotCacheResourcesWithSchemes=e,this.fileService=i,this.cachedConfigurations=new Map,this.cacheHome=t.cacheHome}needsCaching(e){return!this.donotCacheResourcesWithSchemes.includes(e.scheme)}read(e){return this.getCachedConfiguration(e).read()}write(e,t){return this.getCachedConfiguration(e).save(t)}remove(e){return this.getCachedConfiguration(e).remove()}getCachedConfiguration({type:e,key:t}){const i=`${e}:${t}`;let r=this.cachedConfigurations.get(i);return r||(r=new Ee({type:e,key:t},this.cacheHome,this.fileService),this.cachedConfigurations.set(i,r)),r}}class Ee{constructor({type:e,key:t},i,r){this.fileService=r,this.cachedConfigurationFolderResource=(0,$.Vo)(i,"CachedConfigurations",e,t),this.cachedConfigurationFileResource=(0,$.Vo)(this.cachedConfigurationFolderResource,"workspaces"===e?"workspace.json":"configuration.json"),this.queue=new u.ci}async read(){try{return(await this.fileService.readFile(this.cachedConfigurationFileResource)).value.toString()}catch(e){return""}}async save(e){await this.createCachedFolder()&&await this.queue.queue((async()=>{await this.fileService.writeFile(this.cachedConfigurationFileResource,Fe.KN.fromString(e))}))}async remove(){try{await this.queue.queue((()=>this.fileService.del(this.cachedConfigurationFolderResource,{recursive:!0,useTrash:!1})))}catch(e){if(1!==e.fileOperationResult)throw e}}async createCachedFolder(){if(await this.fileService.exists(this.cachedConfigurationFolderResource))return!0;try{return await this.fileService.createFolder(this.cachedConfigurationFolderResource),!0}catch(e){return!1}}}var Oe=i(66663),xe=i(82663),Ne=i(68843),Ae=i(44349),Te=i(26963),Me=i(14118),Ve=i(51858),Le=i(1432),ze=i(26904),je=i(13994);const Ke=Te.ut.registerExtensionPoint({extensionPoint:"resourceLabelFormatters",jsonSchema:{description:(0,W.NC)("vscode.extension.contributes.resourceLabelFormatters","Contributes resource label formatting rules."),type:"array",items:{type:"object",required:["scheme","formatting"],properties:{scheme:{type:"string",description:(0,W.NC)("vscode.extension.contributes.resourceLabelFormatters.scheme",'URI scheme on which to match the formatter on. For example "file". Simple glob patterns are supported.')},authority:{type:"string",description:(0,W.NC)("vscode.extension.contributes.resourceLabelFormatters.authority","URI authority on which to match the formatter on. Simple glob patterns are supported.")},formatting:{description:(0,W.NC)("vscode.extension.contributes.resourceLabelFormatters.formatting","Rules for formatting uri resource labels."),type:"object",properties:{label:{type:"string",description:(0,W.NC)("vscode.extension.contributes.resourceLabelFormatters.label","Label rules to display. For example: myLabel:/${path}. ${path}, ${scheme}, ${authority} and ${authoritySuffix} are supported as variables.")},separator:{type:"string",description:(0,W.NC)("vscode.extension.contributes.resourceLabelFormatters.separator","Separator to be used in the uri label display. '/' or '' as an example.")},stripPathStartingSeparator:{type:"boolean",description:(0,W.NC)("vscode.extension.contributes.resourceLabelFormatters.stripPathStartingSeparator","Controls whether `${path}` substitutions should have starting separator characters stripped.")},tildify:{type:"boolean",description:(0,W.NC)("vscode.extension.contributes.resourceLabelFormatters.tildify","Controls if the start of the uri label should be tildified when possible.")},workspaceSuffix:{type:"string",description:(0,W.NC)("vscode.extension.contributes.resourceLabelFormatters.formatting.workspaceSuffix","Suffix appended to the workspace label.")}}}}}}}),$e=/\//g,Be=/\$\{(scheme|authoritySuffix|authority|path|(query)\.(.+?))\}/g;let qe=class{constructor(e){this.formattersDisposables=new Map,Ke.setHandler(((t,i)=>{for(const t of i.added)for(const i of t.value){const r={...i};"string"!=typeof r.formatting.label&&(r.formatting.label="${authority}${path}"),"string"!=typeof r.formatting.separator&&(r.formatting.separator=xe.ir),!(0,he.$x)(t.description,"contribLabelFormatterWorkspaceTooltip")&&r.formatting.workspaceTooltip&&(r.formatting.workspaceTooltip=void 0),this.formattersDisposables.set(r,e.registerFormatter(r))}for(const e of i.removed)for(const t of e.value)(0,h.B9)(this.formattersDisposables.get(t))}))}};qe=(0,r.g)([(0,r.f)(0,Ae.e)],qe),y.B.as(se.I.Workbench).registerWorkbenchContribution(qe,3);let Je=class extends h.JT{constructor(e,t,i,r,o,s){super(),this.environmentService=e,this.contextService=t,this.pathService=i,this.remoteAgentService=r,this._onDidChangeFormatters=this._register(new n.Q5({leakWarningThreshold:400})),this.onDidChangeFormatters=this._onDidChangeFormatters.event,this.os=Le.OS,this.userHome=i.defaultUriScheme===Oe.lg.file?this.pathService.userHome({preferLocal:!0}):void 0;const a=this.storedFormattersMemento=new je.N("cachedResourceLabelFormatters2",o);this.storedFormatters=a.getMemento(0,1),this.formatters=this.storedFormatters?.formatters?.slice()||[],this.resolveRemoteEnvironment()}async resolveRemoteEnvironment(){const e=await this.remoteAgentService.getEnvironment();this.os=e?.os??Le.OS,this.userHome=await this.pathService.userHome()}findFormatting(e){let t;for(const i of this.formatters)if(i.scheme===e.scheme){if(!i.authority&&(!t||i.priority)){t=i;continue}if(!i.authority)continue;(0,Me.EQ)(i.authority.toLowerCase(),e.authority.toLowerCase())&&(!t||!t.authority||i.authority.length>t.authority.length||i.authority.length===t.authority.length&&i.priority)&&(t=i)}return t?t.formatting:void 0}getUriLabel(e,t={}){let i=this.findFormatting(e);i&&t.separator&&(i={...i,separator:t.separator});const r=this.doGetUriLabel(e,i,t);return!i&&t.separator?r.replace($e,t.separator):r}doGetUriLabel(e,t,i={}){if(!t)return(0,Ne.kz)(e,{os:this.os,tildify:this.userHome?{userHome:this.userHome}:void 0,relative:i.relative?{noPrefix:i.noPrefix,getWorkspace:()=>this.contextService.getWorkspace(),getWorkspaceFolder:e=>this.contextService.getWorkspaceFolder(e)}:void 0});if(i.relative&&this.contextService){let r=this.contextService.getWorkspaceFolder(e);if(!r){const t=this.contextService.getWorkspace(),i=(0,w.Xh)(t.folders);i&&e.scheme!==i.uri.scheme&&e.path.startsWith(xe.KR.sep)&&(r=this.contextService.getWorkspaceFolder(i.uri.with({path:e.path})))}if(r){const o=this.formatUri(r.uri,t,i.noPrefix);let s=this.formatUri(e,t,i.noPrefix),n=0;for(;s[n]&&s[n]===o[n];)n++;if(s[n]&&s[n]!==t.separator?n===o.length&&r.uri.path===xe.KR.sep&&(s=s.substring(n)):s=s.substring(1+n),this.contextService.getWorkspace().folders.length>1&&!i.noPrefix){const e=r?.name??(0,$.Hx)(r.uri);s=s?`${e} • ${s}`:e}return s}}return this.formatUri(e,t,i.noPrefix)}getUriBasenameLabel(e){const t=this.findFormatting(e),i=this.doGetUriLabel(e,t);let r;return r=t?.separator===xe.Ku.sep?xe.Ku:t?.separator===xe.KR.sep?xe.KR:1===this.os?xe.Ku:xe.KR,r.basename(i)}getWorkspaceLabel(e,t){if((0,l.MF)(e)){const i=(0,l.uT)(e);return(0,l.eb)(i)||(0,l.NI)(i)?this.getWorkspaceLabel(i,t):""}return s.ov.isUri(e)?this.doGetSingleFolderWorkspaceLabel(e,t):(0,l.eb)(e)?this.doGetSingleFolderWorkspaceLabel(e.uri,t):(0,l.NI)(e)?this.doGetWorkspaceLabel(e.configPath,t):""}doGetWorkspaceLabel(e,t){if((0,l.ql)(e,this.environmentService))return(0,W.NC)("untitledWorkspace","Untitled (Workspace)");if((0,l.gC)(e))return(0,W.NC)("temporaryWorkspace","Workspace");let i,r=(0,$.EZ)(e);switch(r.endsWith(l.A6)&&(r=r.substr(0,r.length-l.A6.length-1)),t?.verbose){case 0:i=r;break;case 2:i=(0,W.NC)("workspaceNameVerbose","{0} (Workspace)",this.getUriLabel((0,$.Vo)((0,$.XX)(e),r)));break;default:i=(0,W.NC)("workspaceName","{0} (Workspace)",r)}return 0===t?.verbose?i:this.appendWorkspaceSuffix(i,e)}doGetSingleFolderWorkspaceLabel(e,t){let i;return i=2===t?.verbose?this.getUriLabel(e):(0,$.EZ)(e)||xe.KR.sep,0===t?.verbose?i:this.appendWorkspaceSuffix(i,e)}getSeparator(e,t){const i=this.findFormatting(s.ov.from({scheme:e,authority:t}));return i?.separator||xe.KR.sep}getHostLabel(e,t){const i=this.findFormatting(s.ov.from({scheme:e,authority:t}));return i?.workspaceSuffix||t||""}getHostTooltip(e,t){const i=this.findFormatting(s.ov.from({scheme:e,authority:t}));return i?.workspaceTooltip}registerCachedFormatter(e){const t=this.storedFormatters.formatters??=[];let i=t.findIndex((t=>t.scheme===e.scheme&&t.authority===e.authority));if(-1===i&&t.length>=50&&(i=49),-1===i)t.unshift(e);else{for(let e=i;e>0;e--)t[e]=t[e-1];t[0]=e}return this.storedFormattersMemento.saveMemento(),this.registerFormatter(e)}registerFormatter(e){return this.formatters.push(e),this._onDidChangeFormatters.fire({scheme:e.scheme}),{dispose:()=>{this.formatters=this.formatters.filter((t=>t!==e)),this._onDidChangeFormatters.fire({scheme:e.scheme})}}}formatUri(e,t,i){let r=t.label.replace(Be,((i,r,o,s)=>{switch(r){case"scheme":return e.scheme;case"authority":return e.authority;case"authoritySuffix":{const t=e.authority.indexOf("+");return-1===t?e.authority:e.authority.slice(t+1)}case"path":return t.stripPathStartingSeparator?e.path.slice(e.path[0]===t.separator?1:0):e.path;default:if("query"===o){const{query:t}=e;if(t&&"{"===t[0]&&"}"===t[t.length-1])try{return JSON.parse(t)[s]||""}catch{}}return""}}));return t.normalizeDriveLetter&&function(e){return!(!e||":"!==e[2])}(r)&&(r=r.charAt(1).toUpperCase()+r.substr(2)),t.tildify&&!i&&this.userHome&&(r=(0,Ne.Cn)(r,this.userHome.fsPath,this.os)),t.authorityPrefix&&e.authority&&(r=t.authorityPrefix+r),r.replace($e,t.separator)}appendWorkspaceSuffix(e,t){const i=this.findFormatting(t),r=i&&"string"==typeof i.workspaceSuffix?i.workspaceSuffix:void 0;return r?`${e} [${r}]`:e}};Je=(0,r.g)([(0,r.f)(0,oe.n),(0,r.f)(1,l.ec),(0,r.f)(2,Ve.a),(0,r.f)(3,Ue.R),(0,r.f)(4,ze.Uy),(0,r.f)(5,ne.g)],Je);var Ye=i(98e3);function Qe(e){return(0,K.vp)(e.toString()).toString(16)}let He=class e extends h.JT{static{this.RECENTLY_OPENED_KEY="recently.opened"}constructor(e,t,i,r,o,s){super(),this.storageService=e,this.contextService=t,this.logService=i,this.fileService=r,this.environmentService=o,this.uriIdentityService=s,this._onRecentlyOpenedChange=this._register(new n.Q5),this.onDidChangeRecentlyOpened=this._onRecentlyOpenedChange.event,this.addWorkspaceToRecentlyOpened(),this.registerListeners()}registerListeners(){this._register(this.storageService.onDidChangeValue((e=>this.onDidChangeStorage(e)))),this._register(this.contextService.onDidChangeWorkspaceFolders((e=>this.onDidChangeWorkspaceFolders(e))))}onDidChangeStorage(t){t.key===e.RECENTLY_OPENED_KEY&&-1===t.scope&&this._onRecentlyOpenedChange.fire()}onDidChangeWorkspaceFolders(e){if((0,l.gC)(this.contextService.getWorkspace()))for(const t of e.added)this.addRecentlyOpened([{folderUri:t.uri}])}addWorkspaceToRecentlyOpened(){const e=this.contextService.getWorkspace(),t=this.environmentService.remoteAuthority;switch(this.contextService.getWorkbenchState()){case 2:this.addRecentlyOpened([{folderUri:e.folders[0].uri,remoteAuthority:t}]);break;case 3:this.addRecentlyOpened([{workspace:{id:e.id,configPath:e.configuration},remoteAuthority:t}])}}async getRecentlyOpened(){const t=this.storageService.get(e.RECENTLY_OPENED_KEY,-1);if(t){const e=(0,b.OU)(JSON.parse(t),this.logService);return e.workspaces=e.workspaces.filter((e=>!((0,b.ID)(e)&&e.folderUri.scheme===Oe.lg.file&&!(0,l.gC)(this.contextService.getWorkspace())||(0,b.eI)(e)&&(0,l.gC)(e.workspace.configPath)))),e}return{workspaces:[],files:[]}}async addRecentlyOpened(e){const t=await this.getRecentlyOpened();for(const i of e)(0,b.UF)(i)?(this.doRemoveRecentlyOpened(t,[i.fileUri]),t.files.unshift(i)):(0,b.ID)(i)?(this.doRemoveRecentlyOpened(t,[i.folderUri]),t.workspaces.unshift(i)):(this.doRemoveRecentlyOpened(t,[i.workspace.configPath]),t.workspaces.unshift(i));return this.saveRecentlyOpened(t)}async removeRecentlyOpened(e){const t=await this.getRecentlyOpened();return this.doRemoveRecentlyOpened(t,e),this.saveRecentlyOpened(t)}doRemoveRecentlyOpened(e,t){e.files=e.files.filter((e=>!t.some((t=>t.toString()===e.fileUri.toString())))),e.workspaces=e.workspaces.filter((e=>!t.some((t=>t.toString()===((0,b.ID)(e)?e.folderUri.toString():e.workspace.configPath.toString())))))}async saveRecentlyOpened(t){return this.storageService.store(e.RECENTLY_OPENED_KEY,JSON.stringify((0,b.Yc)(t)),-1,0)}async clearRecentlyOpened(){this.storageService.remove(e.RECENTLY_OPENED_KEY,-1)}async enterWorkspace(e){return{workspace:await this.getWorkspaceIdentifier(e)}}async createUntitledWorkspace(e,t){const i=(Date.now()+Math.round(1e3*Math.random())).toString(),r=(0,$.Vo)(this.environmentService.untitledWorkspacesHome,`Untitled-${i}.${l.A6}`),o=[];if(e)for(const t of e)o.push((0,b.l0)(t.uri,!0,t.name,this.environmentService.untitledWorkspacesHome,this.uriIdentityService.extUri));const s={folders:o,remoteAuthority:t};return await this.fileService.writeFile(r,Fe.KN.fromString(JSON.stringify(s,null,"\t"))),this.getWorkspaceIdentifier(r)}async deleteUntitledWorkspace(e){try{await this.fileService.del(e.configPath)}catch(e){if(1!==e.fileOperationResult)throw e}}async getWorkspaceIdentifier(e){return function(e){return{id:Qe(e),configPath:e}}(e)}async getDirtyWorkspaces(){return[]}};He=(0,r.g)([(0,r.f)(0,ze.Uy),(0,r.f)(1,l.ec),(0,r.f)(2,Pe.VZ),(0,r.f)(3,R.sn),(0,r.f)(4,oe.n),(0,r.f)(5,x.v)],He);var Ge=i(12454),Xe=i(94565),Ze=(i(49953),i(85526)),et=i(76446);let tt=class{constructor(e,t,i,r,o,s,n,a,c,h,u,g,l,d,f,p){this.jsonEditingService=e,this.contextService=t,this.configurationService=i,this.notificationService=r,this.commandService=o,this.fileService=s,this.textFileService=n,this.workspacesService=a,this.environmentService=c,this.fileDialogService=h,this.dialogService=u,this.hostService=g,this.uriIdentityService=l,this.workspaceTrustManagementService=d,this.userDataProfilesService=f,this.userDataProfileService=p}async pickNewWorkspacePath(){const e=[Oe.lg.file];this.environmentService.remoteAuthority&&e.unshift(Oe.lg.vscodeRemote);let t=await this.fileDialogService.showSaveDialog({saveLabel:(0,Ne.pH)((0,W.NC)("save","Save")),title:(0,W.NC)("saveWorkspace","Save Workspace"),filters:l.WB,defaultUri:(0,$.Vo)(await this.fileDialogService.defaultWorkspacePath(),this.getNewWorkspaceName()),availableFileSystems:e});if(t)return(0,l.g)(t)||(t=t.with({path:`${t.path}.${l.A6}`})),t}getNewWorkspaceName(){const e=this.getCurrentWorkspaceIdentifier()?.configPath;if(e&&(0,l.AQ)(e,this.environmentService))return(0,$.EZ)(e);const t=(0,w.Xh)(this.contextService.getWorkspace().folders);return t?`${(0,$.EZ)(t.uri)}.${l.A6}`:`workspace.${l.A6}`}async updateFolders(e,t,i,r){const o=this.contextService.getWorkspace().folders;let s=[];"number"==typeof t&&(s=o.slice(e,e+t).map((e=>e.uri)));let n=[];Array.isArray(i)&&(n=i.map((e=>({uri:(0,$.O2)(e.uri),name:e.name}))));const a=s.length>0,c=n.length>0;if(c||a)return c&&!a?this.doAddFolders(n,e,r):a&&!c?this.removeFolders(s):this.includesSingleFolderWorkspace(s)?this.createAndEnterWorkspace(n):3!==this.contextService.getWorkbenchState()?this.doAddFolders(n,e,r):this.doUpdateFolders(n,s,e,r)}async doUpdateFolders(e,t,i,r=!1){try{await this.contextService.updateFolders(e,t,i)}catch(e){if(r)throw e;this.handleWorkspaceConfigurationEditingError(e)}}addFolders(e,t=!1){const i=e.map((e=>({uri:(0,$.O2)(e.uri),name:e.name})));return this.doAddFolders(i,void 0,t)}async doAddFolders(e,t,i=!1){const r=this.contextService.getWorkbenchState(),o=this.environmentService.remoteAuthority;if(o&&(e=e.filter((e=>e.uri.scheme!==Oe.lg.file&&(e.uri.scheme!==Oe.lg.vscodeRemote||(0,$.x5)(e.uri.authority,o))))),3!==r){let i=this.contextService.getWorkspace().folders.map((e=>({uri:e.uri})));if(i.splice("number"==typeof t?t:i.length,0,...e),i=(0,w.EB)(i,(e=>this.uriIdentityService.extUri.getComparisonKey(e.uri))),1===r&&0===i.length||2===r&&1===i.length)return;return this.createAndEnterWorkspace(i)}try{await this.contextService.addFolders(e,t)}catch(e){if(i)throw e;this.handleWorkspaceConfigurationEditingError(e)}}async removeFolders(e,t=!1){if(this.includesSingleFolderWorkspace(e))return this.createAndEnterWorkspace([]);try{await this.contextService.removeFolders(e)}catch(e){if(t)throw e;this.handleWorkspaceConfigurationEditingError(e)}}includesSingleFolderWorkspace(e){if(2===this.contextService.getWorkbenchState()){const t=this.contextService.getWorkspace().folders[0];return e.some((e=>this.uriIdentityService.extUri.isEqual(e,t.uri)))}return!1}async createAndEnterWorkspace(e,t){if(t&&!await this.isValidTargetWorkspacePath(t))return;const i=this.environmentService.remoteAuthority,r=await this.workspacesService.createUntitledWorkspace(e,i);if(t)try{await this.saveWorkspaceAs(r,t)}finally{await this.workspacesService.deleteUntitledWorkspace(r)}else t=r.configPath,this.userDataProfileService.currentProfile.isDefault||await this.userDataProfilesService.setProfileForWorkspace(r,this.userDataProfileService.currentProfile);return this.enterWorkspace(t)}async saveAndEnterWorkspace(e){const t=this.getCurrentWorkspaceIdentifier();if(t){if((0,$.Xy)(t.configPath,e))return this.saveWorkspace(t);if(await this.isValidTargetWorkspacePath(e))return await this.saveWorkspaceAs(t,e),this.enterWorkspace(e)}}async isValidTargetWorkspacePath(e){return!0}async saveWorkspaceAs(e,t){const i=e.configPath;if(!(0,l.ql)(t,this.environmentService)&&!this.userDataProfileService.currentProfile.isDefault){const e=await this.workspacesService.getWorkspaceIdentifier(t);await this.userDataProfilesService.setProfileForWorkspace(e,this.userDataProfileService.currentProfile)}if(this.uriIdentityService.extUri.isEqual(i,t))return;const r=(0,l.ql)(i,this.environmentService),o=await this.fileService.readFile(i),s=(0,b.XB)(o.value.toString(),i,r,t,this.uriIdentityService.extUri);await this.textFileService.create([{resource:t,value:s,options:{overwrite:!0}}]),await this.trustWorkspaceConfiguration(t)}async saveWorkspace(e){const t=e.configPath,i=this.textFileService.files.get(t);if(i)return void await i.save({force:!0,reason:1});if(await this.fileService.exists(t))return;const r=(0,b.XB)(JSON.stringify({folders:[]},null,"\t"),t,!1,t,this.uriIdentityService.extUri);await this.textFileService.create([{resource:t,value:r}])}handleWorkspaceConfigurationEditingError(e){0===e.code?this.onInvalidWorkspaceConfigurationFileError():this.notificationService.error(e.message)}onInvalidWorkspaceConfigurationFileError(){const e=(0,W.NC)("errorInvalidTaskConfiguration","Unable to write into workspace configuration file. Please open the file to correct errors/warnings in it and try again.");this.askToOpenWorkspaceConfigurationFile(e)}askToOpenWorkspaceConfigurationFile(e){this.notificationService.prompt(E.zb.Error,e,[{label:(0,W.NC)("openWorkspaceConfigurationFile","Open Workspace Configuration"),run:()=>this.commandService.executeCommand("workbench.action.openWorkspaceConfigFile")}])}async doEnterWorkspace(e){if(this.environmentService.extensionTestsLocationURI)throw new Error("Entering a new workspace is not possible in tests.");const t=await this.workspacesService.getWorkspaceIdentifier(e);return 2===this.contextService.getWorkbenchState()&&await this.migrateWorkspaceSettings(t),await this.configurationService.initialize(t),this.workspacesService.enterWorkspace(e)}migrateWorkspaceSettings(e){return this.doCopyWorkspaceSettings(e,(e=>3===e.scope))}copyWorkspaceSettings(e){return this.doCopyWorkspaceSettings(e)}doCopyWorkspaceSettings(e,t){const i=y.B.as(_.IP.Configuration).getConfigurationProperties(),r={};for(const e of this.configurationService.keys().workspace)if(i[e]){if(t&&!t(i[e]))continue;r[e]=this.configurationService.inspect(e).workspaceValue}return this.jsonEditingService.write(e.configPath,[{path:["settings"],value:r}],!0)}async trustWorkspaceConfiguration(e){1!==this.contextService.getWorkbenchState()&&this.workspaceTrustManagementService.isWorkspaceTrusted()&&await this.workspaceTrustManagementService.setUrisTrust([e],!0)}getCurrentWorkspaceIdentifier(){const e=(0,l.uT)(this.contextService.getWorkspace());if((0,l.NI)(e))return e}};tt=(0,r.g)([(0,r.f)(0,le.R),(0,r.f)(1,l.ec),(0,r.f)(2,m.FG),(0,r.f)(3,E.lT),(0,r.f)(4,Xe.H),(0,r.f)(5,R.sn),(0,r.f)(6,P.MM),(0,r.f)(7,b.Dc),(0,r.f)(8,oe.n),(0,r.f)(9,et.Z$),(0,r.f)(10,et.Ss),(0,r.f)(11,Ze.$),(0,r.f)(12,x.v),(0,r.f)(13,ce.Y2),(0,r.f)(14,V.lv),(0,r.f)(15,M.AP)],tt);var it=i(90553);const rt=y.B.as(g.I.JSONContribution),ot=y.B.as(_.IP.Configuration),st={type:"object",defaultSnippets:[{body:{title:"",properties:{}}}],properties:{title:{description:W.NC("vscode.extension.contributes.configuration.title","A title for the current category of settings. This label will be rendered in the Settings editor as a subheading. If the title is the same as the extension display name, then the category will be grouped under the main extension heading."),type:"string"},order:{description:W.NC("vscode.extension.contributes.configuration.order","When specified, gives the order of this category of settings relative to other categories."),type:"integer"},properties:{description:W.NC("vscode.extension.contributes.configuration.properties","Description of the configuration properties."),type:"object",propertyNames:{pattern:"\\S+",patternErrorMessage:W.NC("vscode.extension.contributes.configuration.property.empty","Property should not be empty.")},additionalProperties:{anyOf:[{title:W.NC("vscode.extension.contributes.configuration.properties.schema","Schema of the configuration property."),$ref:"http://json-schema.org/draft-07/schema#"},{type:"object",properties:{scope:{type:"string",enum:["application","machine","window","resource","language-overridable","machine-overridable"],default:"window",enumDescriptions:[W.NC("scope.application.description","Configuration that can be configured only in the user settings."),W.NC("scope.machine.description","Configuration that can be configured only in the user settings or only in the remote settings."),W.NC("scope.window.description","Configuration that can be configured in the user, remote or workspace settings."),W.NC("scope.resource.description","Configuration that can be configured in the user, remote, workspace or folder settings."),W.NC("scope.language-overridable.description","Resource configuration that can be configured in language specific settings."),W.NC("scope.machine-overridable.description","Machine configuration that can be configured also in workspace or folder settings.")],markdownDescription:W.NC("scope.description","Scope in which the configuration is applicable. Available scopes are `application`, `machine`, `window`, `resource`, and `machine-overridable`.")},enumDescriptions:{type:"array",items:{type:"string"},description:W.NC("scope.enumDescriptions","Descriptions for enum values")},markdownEnumDescriptions:{type:"array",items:{type:"string"},description:W.NC("scope.markdownEnumDescriptions","Descriptions for enum values in the markdown format.")},enumItemLabels:{type:"array",items:{type:"string"},markdownDescription:W.NC("scope.enumItemLabels","Labels for enum values to be displayed in the Settings editor. When specified, the {0} values still show after the labels, but less prominently.","`enum`")},markdownDescription:{type:"string",description:W.NC("scope.markdownDescription","The description in the markdown format.")},deprecationMessage:{type:"string",description:W.NC("scope.deprecationMessage","If set, the property is marked as deprecated and the given message is shown as an explanation.")},markdownDeprecationMessage:{type:"string",description:W.NC("scope.markdownDeprecationMessage","If set, the property is marked as deprecated and the given message is shown as an explanation in the markdown format.")},editPresentation:{type:"string",enum:["singlelineText","multilineText"],enumDescriptions:[W.NC("scope.singlelineText.description","The value will be shown in an inputbox."),W.NC("scope.multilineText.description","The value will be shown in a textarea.")],default:"singlelineText",description:W.NC("scope.editPresentation","When specified, controls the presentation format of the string setting.")},order:{type:"integer",description:W.NC("scope.order","When specified, gives the order of this setting relative to other settings within the same category. Settings with an order property will be placed before settings without this property set.")},ignoreSync:{type:"boolean",description:W.NC("scope.ignoreSync","When enabled, Settings Sync will not sync the user value of this configuration by default.")}}}]}}}};let nt;const at=Te.ut.registerExtensionPoint({extensionPoint:"configurationDefaults",jsonSchema:{$ref:_.Tk}});at.setHandler(((e,{added:t,removed:i})=>{nt&&ot.deltaConfiguration(nt);const r=nt={};if(queueMicrotask((()=>{nt===r&&(ot.deltaConfiguration(nt),nt=void 0)})),i.length){const e=i.map((e=>({overrides:c.I8(e.value),source:{id:e.description.identifier.value,displayName:e.description.displayName}})));nt.removedDefaults=e}if(t.length){const e=ot.getConfigurationProperties(),i=[6,3,4,5],r=t.map((t=>{const r=c.I8(t.value);for(const o of Object.keys(r))if(!_.eU.test(o)){const s=e[o];s?.scope&&!i.includes(s.scope)&&(t.collector.warn(W.NC("config.property.defaultConfiguration.warning","Cannot register configuration defaults for '{0}'. Only defaults for machine-overridable, window, resource and language overridable scoped settings are supported.",o)),delete r[o])}return{overrides:r,source:{id:t.description.identifier.value,displayName:t.description.displayName}}}));nt.addedDefaults=r}}));const ct=Te.ut.registerExtensionPoint({extensionPoint:"configuration",deps:[at],jsonSchema:{description:W.NC("vscode.extension.contributes.configuration","Contributes configuration settings."),oneOf:[st,{type:"array",items:st}]}}),ht=new it.C1;ct.setHandler(((e,{added:t,removed:i})=>{if(nt??={},i.length){const e=[];for(const t of i)e.push(...ht.get(t.description.identifier)||[]),ht.delete(t.description.identifier);nt.removedConfigurations=e}const r=new Set;function o(e,t){const i=[],r=c.I8(e);return r.title&&"string"!=typeof r.title&&t.collector.error(W.NC("invalid.title","'configuration.title' must be a string")),s(r,t),r.id=e.id||t.description.identifier.value,r.extensionInfo={id:t.description.identifier.value,displayName:t.description.displayName},r.restrictedProperties="limited"===t.description.capabilities?.untrustedWorkspaces?.supported?t.description.capabilities?.untrustedWorkspaces.restrictedConfigurations:void 0,r.title=r.title||t.description.displayName||t.description.identifier.value,i.push(r),i}function s(e,t){const i=e.properties;if(i){"object"!=typeof i&&(t.collector.error(W.NC("invalid.properties","'configuration.properties' must be an object")),e.properties={});for(const e in i){const o=i[e],s=(0,_.uO)(e,o);s?(delete i[e],t.collector.warn(s)):r.has(e)?(delete i[e],t.collector.warn(W.NC("config.property.duplicate","Cannot register '{0}'. This property is already registered.",e))):(0,C.Kn)(o)?(r.add(e),o.scope?"application"===o.scope.toString()?o.scope=1:"machine"===o.scope.toString()?o.scope=2:"resource"===o.scope.toString()?o.scope=4:"machine-overridable"===o.scope.toString()?o.scope=6:"language-overridable"===o.scope.toString()?o.scope=5:o.scope=3:o.scope=3):(delete i[e],t.collector.error(W.NC("invalid.property","configuration.properties property '{0}' must be an object",e)))}}const o=e.allOf;if(o){t.collector.error(W.NC("invalid.allOf","'configuration.allOf' is deprecated and should no longer be used. Instead, pass multiple configuration sections as an array to the 'configuration' contribution point."));for(const e of o)s(e,t)}}if(t.length){const e=[];for(const i of t){const t=[],r=i.value;Array.isArray(r)?r.forEach((e=>t.push(...o(e,i)))):t.push(...o(r,i)),ht.set(i.description.identifier,t),e.push(...t)}nt.addedConfigurations=e}ot.deltaConfiguration(nt),nt=void 0})),rt.registerSchema("vscode://schemas/workspaceConfig",{allowComments:!0,allowTrailingCommas:!0,default:{folders:[{path:""}],settings:{}},required:["folders"],properties:{folders:{minItems:0,uniqueItems:!0,description:W.NC("workspaceConfig.folders.description","List of folders to be loaded in the workspace."),items:{type:"object",defaultSnippets:[{body:{path:"$1"}}],oneOf:[{properties:{path:{type:"string",description:W.NC("workspaceConfig.path.description","A file path. e.g. `/root/folderA` or `./folderA` for a relative path that will be resolved against the location of the workspace file.")},name:{type:"string",description:W.NC("workspaceConfig.name.description","An optional name for the folder. ")}},required:["path"]},{properties:{uri:{type:"string",description:W.NC("workspaceConfig.uri.description","URI of the folder")},name:{type:"string",description:W.NC("workspaceConfig.name.description","An optional name for the folder. ")}},required:["uri"]}]}},settings:{type:"object",default:{},description:W.NC("workspaceConfig.settings.description","Workspace settings"),$ref:m.oL},launch:{type:"object",default:{configurations:[],compounds:[]},description:W.NC("workspaceConfig.launch.description","Workspace launch configurations"),$ref:m.yY},tasks:{type:"object",default:{version:"2.0.0",tasks:[]},description:W.NC("workspaceConfig.tasks.description","Workspace task configurations"),$ref:m.li},extensions:{type:"object",default:{},description:W.NC("workspaceConfig.extensions.description","Workspace extensions"),$ref:"vscode://schemas/extensions"},remoteAuthority:{type:"string",doNotSuggest:!0,description:W.NC("workspaceConfig.remoteAuthority","The remote server where the workspace is located.")},transient:{type:"boolean",doNotSuggest:!0,description:W.NC("workspaceConfig.transient","A transient workspace will disappear when restarting or reloading.")}},errorMessage:W.NC("unknownWorkspaceProperty","Unknown workspace configuration property")});var ut=i(89118),gt=i(5107),lt=i(75560);async function dt(e){const t=o.IO.get(V.lv);await o.IO.get(R.sn).writeFile(t.defaultProfile.settingsResource,Fe.KN.fromString(e))}async function ft(){const e=o.IO.get(V.lv);return(await o.IO.get(R.sn).readFile(e.defaultProfile.settingsResource)).value.toString()}function pt(e){const t=o.IO.get(V.lv);return o.IO.get(R.sn).onDidFilesChange((i=>{i.affects(t.defaultProfile.settingsResource)&&e()}))}const Ct=y.B.as(_.IP.Configuration);let wt=class extends Ce{constructor(e,t,i,r,o,s,n,a){super({configurationCache:new Ie([Oe.lg.file,Oe.lg.vscodeUserData,Oe.lg.tmp],e,r)},e,t,i,r,o,s,n,a)}};wt=(0,r.g)([(0,r.f)(0,oe.n),(0,r.f)(1,M.AP),(0,r.f)(2,V.lv),(0,r.f)(3,R.sn),(0,r.f)(4,Ue.R),(0,r.f)(5,x.v),(0,r.f)(6,Pe.VZ),(0,r.f)(7,ge.Wu)],wt);class vt extends tt{constructor(){super(...arguments),this.enterWorkspace=gt.Jc}}let kt=s.ov.file("/workspace");(0,lt.es)((async e=>{const t=e.get(l.ec);t.acquireInstantiationService(e.get(Re.TG));const i=kt.with({path:"/workspace.code-workspace"});try{const t=e.get(R.sn);await t.createFolder(kt),await t.writeFile(i,Fe.KN.fromString(JSON.stringify({folders:[{path:kt.path}]})))}catch(e){}await t.initialize({id:(0,Ye.R)(),configPath:i})}));const St=(0,gt.pL)(wt);function mt(e){return kt=e,{...(0,ut.ZP)(),[Ae.e.toString()]:new De.M(Je,void 0,!0),[f.Ui.toString()]:new De.M(St,[],!0),[l.ec.toString()]:new De.M(St,[],!0),[Se.V.toString()]:new De.M(be,[],!0),[Ge.o.toString()]:new De.M(vt,[],!0),[b.Dc.toString()]:new De.M(He,void 0,!0)}}},10469:(e,t,i)=>{i.d(t,{$S:()=>c,A6:()=>W,Bf:()=>b,FG:()=>F,G:()=>m,Nj:()=>s,Nr:()=>C,QN:()=>_,ao:()=>y,at:()=>g,eS:()=>w,eZ:()=>k,ec:()=>S,ek:()=>R,el:()=>D,iF:()=>P,kd:()=>a,l3:()=>n,li:()=>p,nT:()=>u,oL:()=>l,p7:()=>d,qz:()=>v,v7:()=>h,yY:()=>f});var r=i(33108),o=i(72065);const s=".vscode",n="settings",a=`${s}/${n}.json`,c="vscode://schemas/settings/default",h="vscode://schemas/settings/user",u="vscode://schemas/settings/profile",g="vscode://schemas/settings/machine",l="vscode://schemas/settings/workspace",d="vscode://schemas/settings/folder",f="vscode://schemas/launch",p="vscode://schemas/tasks",C=[1],w=[2,3,4,5,6],v=[3,4,5],k=[1,...v],S=[2,3,4,5,6],m=[3,4,5,6],y=[4,5,6],_="tasks",b="launch",W=Object.create(null);W[_]=`${s}/${_}.json`,W[b]=`${s}/${b}.json`;const D=Object.create(null);D[_]=`${_}.json`;const F=(0,o.LO)(r.Ui),P='{\n\t"version": "2.0.0",\n\t"tasks": []\n}',R="workbench.settings.applyToAllProfiles"}}]);
//# sourceMappingURL=700.bundle.js.map